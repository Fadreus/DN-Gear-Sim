!function(){"use strict";function e(e){e.when("/about",{templateUrl:"ui/about/about.html",controller:"AboutCtrl as about"}).when("/setup",{templateUrl:"ui/nav/setup.html",controller:"SetupCtrl"}).when("/test",{templateUrl:"ui/nav/test.html",controller:"TestCtrl"}).when("/items/",{templateUrl:"ui/secrets/items.html",controller:"ItemsCtrl as items"}).when("/",{redirectTo:"/builds"}).when("/builds",{templateUrl:"ui/builds/build-list.html",controller:"BuildListCtrl as buildList"}).when("/build/:groupName*",{templateUrl:"ui/builds/build-list.html",controller:"BuildListCtrl as buildList"}).when("/view-group/:region?",{templateUrl:"ui/builds/view-group.html",controller:"ViewGroupCtrl"}).when("/edit-build/:groupName*",{templateUrl:"ui/builds/edit-build.html",controller:"EditBuildCtrl as editGroup",reloadOnSearch:!1}).when("/new-build",{templateUrl:"ui/builds/edit-build.html",controller:"EditBuildCtrl as editGroup",reloadOnSearch:!1}).when("/delete-build/:name*",{templateUrl:"ui/builds/delete-build.html",controller:"DeleteBuildCtrl as deleteBuild",reloadOnSearch:!1}).when("/search/:itemType?",{templateUrl:"ui/search/item-search.html",controller:"ItemSearchCtrl as ctrl"}).when("/item/:region?/:i*",{templateUrl:"ui/item/item.html",controller:"ItemCtrl",reloadOnSearch:!1}).when("/export",{templateUrl:"ui/nav/export.html",controller:"ExportCtrl"}).when("/talismans",{templateUrl:"ui/builds/build-talismans.html",controller:"BuildTalismansCtrl as ctrl"}).when("/publish",{templateUrl:"ui/online/publish.html",controller:"PublishCtrl as ctrl"}).when("/publish",{templateUrl:"ui/online/publish.html",controller:"PublishCtrl as ctrl"}).when("/profile/:uid",{templateUrl:"ui/online/profile.html",controller:"ProfileCtrl as ctrl"}).when("/published/:uid/:buildName*",{templateUrl:"ui/online/published.html",controller:"PublishedCtrl as ctrl"}).when("/build-search/:jobId?",{templateUrl:"ui/online/build-search.html",controller:"BuildSearchCtrl as ctrl"}).otherwise({redirectTo:"/builds"})}angular.module("dnsim").config(["$routeProvider",e])}(),function(){"use strict";angular.module("dnsim").controller("AboutCtrl",["$window",function(e){document.body.className="default-back",e.document.title="DN Gear Sim"}])}(),angular.module("dnsim").controller("buildActionsCtrl",["$timeout","$location","hCodeValues","statHelper","itemCategory","saveHelper","exportLinkHelper","groupHelper","translations","dntData","dntReset",function(e,t,n,a,i,s,o,r,l,m,u){"use strict";function c(){if(!h.reloaded){var t=!0,n=r.getDntFiles(h.build);if(angular.forEach(n,function(e,n){if(!m.isLoaded(n))return void(t=!1)}),t&&l.isLoaded()){var a=r.reloadGroup(h.buildName,h.build);s.updatedSavedItems(h.buildName,a),h.build.items=a,h.reloaded=!0,e(h.onChange)}}}function d(){}var h=this;this.deleteGroup=function(){t.path("/delete-build/"+h.buildName)},this.editGroup=function(){t.path("/edit-build/"+h.buildName)},this.copyGroup=function(){var e=s.importGroup(h.buildName,h.build.items);s.renameSavedGroup(e,e,h.build.enemyLevel,h.build.playerLevel,h.build.heroLevel,h.build.job,h.build.damageType,h.build.element,h.build.secondaryElement,h.build.enemyStatCaps,h.build.playerStatCaps,h.build.conversions,h.build.baseStats,h.build.heroStats),t.path("/build/"+e)},this.reloaded=!1,this.reloadGroup=function(){u(),h.reloaded=!1,l.init(d,c);var e=r.getDntFiles(h.build);angular.forEach(e,function(e,t){m.init(t,e,d,c)}),h.onChange()},this.createShortUrl=function(){o.createShortUrl(h.buildName,h.build)},this.setShortUrl=function(){if(h.build){var e=o.createGroupLink(h.buildName,h.build);h.build.shortUrl=sessionStorage.getItem(e)}},this.setShortUrl()}]).directive("dngearsimBuildActions",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build",onChange:"&onChange"},controller:"buildActionsCtrl",controllerAs:"buildActions",templateUrl:"ui/builds/build-actions.html"}}),angular.module("dnsim").controller("buildItemCtrl",["$timeout","statHelper","saveHelper",function(e,t,n){"use strict"}]).directive("dngearsimBuildItem",function(){return{scope:!0,bindToController:{item:"=item"},controller:"buildItemCtrl",controllerAs:"ctrl",templateUrl:"ui/builds/build-item.html"}}),angular.module("dnsim").controller("BuildListCtrl",["$window","$location","$routeParams","$timeout","saveHelper",function(e,t,n,a,i){"use strict";var s=this;document.body.className="saved-back",this.setupBuilds=function(){s.savedItems=i.getSavedItems(),s.buildNames=Object.keys(s.savedItems).sort(),s.builds=[];for(var e=0;e<s.buildNames.length;++e)s.builds.push({name:s.buildNames[e],build:s.savedItems[s.buildNames[e]]})},this.setupBuilds(),"groupName"in n?n.groupName!=this.currentGroup&&(this.currentGroup=n.groupName,i.saveBuildSelection(this.currentGroup,this.savedItems)):this.currentGroup&&this.currentGroup in this.savedItems?t.path("/build/"+this.currentGroup):this.currentGroup=null,this.currentGroup?e.document.title="DN Gear Sim | "+this.currentGroup:e.document.title="DN Gear Sim | BUILDS",this.anyItems=function(){return Object.keys(this.savedItems).length>0},this.createGroup=function(){t.path("/new-build")},this.handleChange=function(){s.setupBuilds(),a()},this.toggleGroup=function(e){i.saveBuildSelection(e,this.savedItems),t.url("/build/"+e)},this.publish=function(){t.url("/publish")},this.search=function(){t.url("/build-search")}}]),angular.module("dnsim").controller("buildStatsCtrl",["$routeParams","$location","hCodeValues","statHelper","itemCategory",function(e,t,n,a,i){"use strict"}]).directive("dngearsimBuildStats",function(){return{scope:!0,bindToController:{stats:"=stats",build:"=build"},controller:"buildStatsCtrl",controllerAs:"statsCtrl",templateUrl:"ui/builds/build-stats.html"}}),angular.module("dnsim").controller("buildSummaryCtrl",["$routeParams","$location","hCodeValues","statHelper","itemCategory",function(e,t,n,a,i){"use strict";var s=this;this.stats=a.getBuildStats(this.build),this.itemsByCategory=i.getItemsByCategory(this.build.items),this.getSaveDate=function(e){if(s.build.lastUpdate>0){var t=new Date(s.build.lastUpdate);return t.toLocaleDateString()}},this.getSaveTime=function(e){if(s.build.lastUpdate>0){var t=new Date(s.build.lastUpdate);return t.toLocaleTimeString()}},this.getBuildSummary=function(e){var t="";return angular.forEach(s.itemsByCategory,function(e,n){e.length>0&&(t.length>0&&(t+=", "),t+=e.length+" "+n)}),t}}]).directive("dngearsimBuildSummary",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build"},controller:"buildSummaryCtrl",controllerAs:"buildCtrl",templateUrl:"ui/builds/build-summary.html"}}),angular.module("dnsim").controller("BuildTalismansCtrl",["$window","$location","$routeParams","$timeout","saveHelper","statHelper","jobs","hCodeValues","itemColumnsToLoad","character",function(e,t,n,a,i,s,o,r,l,m){"use strict";function u(e,t){return e&&t?Math.round(1e4*(1-t/e))/100:0}var c=this;if(e.document.title="DN Gear Sim | TALISMANS",e.scrollTo(0,0),this.savedItems=i.getSavedItems(),this.groupNames=Object.keys(this.savedItems),this.groupNames||(this.groupNames=[]),this.groupNames.length>0?this.groupName=i.getCurrentBuild():this.groupName=null,this.groupName&&this.groupName in this.savedItems||this.groupNames.length>0&&(this.groupName=this.groupNames[0]),this.groupName){this.getGroupCalcStats=function(){if(null==this.groupCalcStats){var e=c.savedItems[c.groupName];e&&(this.groupCalcStats=this.getCalculatedStats(e,e.items))}return this.groupCalcStats},this.getBuild=function(){return c.savedItems[c.groupName]},this.pickup=function(e){c.selectedIndex=e,c.replaceHPAffectAmount=[],c.replaceMDmgAffectAmount=[],c.replacePDmgAffectAmount=[],c.replaceAvgDmgAffectAmount=[]},this.getCalculatedStats=function(e,t){var n=s.getNakedStats(e),a=s.getCombinedStats(t),i=s.getSetStats(t),o=n.concat(a).concat(i);return null!=e.heroStats&&e.heroStats.length>0&&(o=o.concat(e.heroStats)),o=r.mergeStats(o),s.getCalculatedStats(e,o)},this.headers=["+100%","+75%","+25%","+0%"],this.summaryStatIds=[];for(var d in r.stats)r.stats[d].summaryDisplay&&this.summaryStatIds.push(d);this.pcIndexes={},this.pcIndexes[100]=0,this.pcIndexes[75]=1,this.pcIndexes[25]=2,this.pcIndexes[0]=3,this.selectedIndex=-1,this.rows=[],this.updateRows=function(){c.rows=[],angular.forEach(c.savedItems[c.groupName].items,function(e,t){if("talisman"==e.typeName){var n=c.pcIndexes[e.enchantmentNum];n||0==n||(n=3);for(var a=0;;){if(c.rows[a]||(c.rows[a]=c.makeFakeCells()),c.rows[a][n].index<0){e.enchantmentNum||(e.enchantmentNum=0);var i=c.makeCell(e,t);c.rows[a][n]=i;break}a++}}}),c.rows.length<3&&(c.rows[c.rows.length+1]=c.makeFakeCells())},this.makeFakeCells=function(e){return[c.makeCell({enchantmentNum:100},-1),c.makeCell({enchantmentNum:75},-2),c.makeCell({enchantmentNum:25},-3),c.makeCell({enchantmentNum:0},-4)]},this.makeCell=function(e,t){return{item:e,index:t}},this.click=function(e){c.selectedIndex==-1?e.index>=0&&c.pickup(e.index):c.move(e)},this.move=function(e){var t=c.savedItems[c.groupName].items;if(e.index>=0){var n=e.item.enchantmentNum;c.setTalisman(e.item,t[c.selectedIndex].enchantmentNum),c.setTalisman(t[c.selectedIndex],n),t[e.index]=t[c.selectedIndex],t[c.selectedIndex]=e.item}else{var i=t[c.selectedIndex];c.setTalisman(i,e.item.enchantmentNum),t.splice(c.selectedIndex,1),t.push(i)}c.groupCalcStats=null,c.selectedIndex=-1,c.updateRows(),c.replaceAffectAmount={},a()},this.setTalisman=function(e,t){var n=[];angular.forEach(e.stats,function(e,a){t&&n.push({id:e.id,max:e.max*(t/100)})}),e.enchantmentStats=n,e.enchantmentNum=t,e.fullStats=r.mergeStats(e.enchantmentStats,e.stats)},this.replaceAffectAmount={},this.getReplaceAffectAmount=function(e,t,n){if(this.initReplaceAffects(t,n),this.replaceAffectAmount[t])return this.replaceAffectAmount[t][e]},this.initReplaceAffects=function(e,t){if(!c.replaceAffectAmount[e]&&c.selectedIndex!=-1){this.replaceAffectAmount[e]={};var n=c.savedItems[c.groupName],a=n.items[c.selectedIndex],i=[],s=[];t.stats&&(angular.forEach(t.stats,function(e,t){i.push({id:e.id,max:e.max*(a.enchantmentNum/100)})}),s=r.mergeStats(i,t.stats)),i=[],angular.forEach(a.stats,function(e,n){i.push({id:e.id,max:e.max*(t.enchantmentNum/100)})});var o=r.mergeStats(i,a.stats),l=[{stats:s},{stats:o}];angular.forEach(n.items,function(e,n){t!==e&&a!==e&&l.push(e)});var m=c.getCalculatedStats(n,l),d=c.getGroupCalcStats();for(var h in r.stats)r.stats[h].summaryDisplay&&(c.replaceAffectAmount[e][h]=u(c.getStat(h,m).max,c.getStat(h,d).max))}},this.getStatName=function(e){var t="";if("primary"==r.stats[e].element){var n=0;c.savedItems[c.groupName].element&&(n=c.savedItems[c.groupName].element.id),t+=r.elements[n].name}else if("secondary"==r.stats[e].element){var n=0;c.savedItems[c.groupName].secondaryElement&&(n=c.savedItems[c.groupName].secondaryElement.id),t+=r.elements[n].name}return t+" "+r.stats[e].name},this.getStat=function(e,t){for(var n=t.length,a=0;a<n;++a)if(t[a].id==e)return t[a];return{id:e,max:0}},this.save=function(){i.updatedSavedItems(c.groupName,c.savedItems[c.groupName].items),t.path("/build/"+c.groupName)},this.updateRows()}}]),angular.module("dnsim").controller("buildCtrl",["$timeout","$location","hCodeValues","statHelper","itemCategory","saveHelper",function(e,t,n,a,i,s){"use strict";var o=this;this.stats=a.getBuildStats(this.build);var r=localStorage.getItem("selectedItemCategory");this.category=i.byName(r),this.category||(r="titles",this.category=i.byName("titles")),this.getCategoryItems=function(){var e=i.getItemsByCategory(this.build.items);return o.category.name in e?e[o.category.name]:[]},this.getCategories=function(){return i.categories},this.setSelectedCategory=function(e){this.category=i.byName(e),localStorage.setItem("selectedItemCategory",e)},this.getSaveDate=function(e){if(o.build.lastUpdate>0){var t=new Date(o.build.lastUpdate);return t.toLocaleDateString()}},this.getSaveTime=function(e){if(o.build.lastUpdate>0){var t=new Date(o.build.lastUpdate);return t.toLocaleTimeString()}},this.allowMoreItems=function(){return!o.category.maxCat||this.getCategoryItems().length<o.category.maxCat},this.getItemCount=function(){var e="",t=o.build.items;if("offensive gems"==o.category.name){var n=0,a=0;angular.forEach(t,function(e,t){e.typeName==o.category.name?a++:e.offensiveGemSlots&&(n+=e.offensiveGemSlots)}),e=a+" / "+n}else if("increasing gems"==o.category.name){var s=0,r=0,l={};angular.forEach(t,function(e,t){if(e.typeName==o.category.name){var n=e.sparkTypeId;n||(n=0),n in l||(l[n]=0),l[n]++,s++}else e.increasingGemSlots&&(r+=e.increasingGemSlots)}),e="",angular.forEach(l,function(t,n){e.length>0&&(e+="+"),e+=t}),e=s+" ("+e+") / "+r}else{var m=0;angular.forEach(t,function(e,t){e&&e.typeName==o.category.name&&m++}),e=m;var u=i.byName(o.category.name);u&&"numItemText"in u&&(e+=" / "+u.numItemText)}return e+" "+o.category.name},this.handleChange=function(){o.stats=a.getBuildStats(o.build),o.onChange()},this.removeItem=function(e){e.removeItem=!0;var t=[];angular.forEach(o.build.items,function(e,n){e&&!e.removeItem&&t.push(e)}),o.build.items=t,s.updatedSavedItems(o.buildName,t),o.handleChange()}}]).directive("dngearsimBuild",function(){return{scope:!0,bindToController:{buildName:"=buildName",build:"=build",onChange:"&onChange",server:"=server"},controller:"buildCtrl",controllerAs:"buildCtrl",templateUrl:"ui/builds/build.html"}}),angular.module("dnsim").controller("DeleteBuildCtrl",["$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad",function(e,t,n,a,i,s,o,r){"use strict";this.newGroup=!0,"name"in t&&(this.name=t.name),this["delete"]=function(){a.updatedSavedItems(this.name,[]),e.path("/builds/")}}]),angular.module("dnsim").controller("EditBuildCtrl",["$window","$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad","character",function(e,t,n,a,i,s,o,r,l,m){"use strict";var u=this;this.savedItems=i.getSavedItems(),this.group={},this.newGroup=!0,"groupName"in n?(this.groupName=n.groupName,this.groupName in this.savedItems&&(this.group=this.savedItems[this.groupName],this.newGroup=!1)):this.groupName="",this.oldGroupName=this.groupName,this.heroStats=[],this.elements=r.elements,this.damageTypes=r.damageTypes,this.group.damageType?this.damageType=this.group.damageType:this.damageType=r.damageTypes[0],this.group.element?this.element=this.group.element:this.element=r.elements[0],this.group.secondaryElement?this.secondaryElement=this.group.secondaryElement:this.secondaryElement=r.elements[0],this.group.enemyLevel?this.enemyLevel=this.group.enemyLevel:this.enemyLevel=90,this.group.playerLevel?this.playerLevel=this.group.playerLevel:this.playerLevel=90,this.group.heroLevel&&this.group.heroLevel>0?this.heroLevel=this.group.heroLevel:this.heroLevel=1,this.init=function(e){var t=o.getFinalJobs();t.length>0&&a(function(){"job"in e.group&&angular.forEach(t,function(t,n){t.id==e.group.job.id&&(e.job=t)}),e.setHeroStats()})},this.setJob=function(){e.scrollTo(0,0)},m.init(function(){u.init(u)}),this.getStatCap=function(e,t){return m.getStatCaps(t)[e]},this.getJobConversion=function(e){return m.getConversions(this.job.id)[e]},this.getJobBaseStat=function(e){return m.getBaseStats(this.playerLevel,this.job.id)[e]},this.invalidGroupName=function(){return!this.groupName||!(!(this.groupName in this.savedItems)||!this.newGroup&&this.groupName==this.oldGroupName)},this.ok=function(){var e=m.getStatCaps(this.enemyLevel),n=m.getStatCaps(this.playerLevel),a=m.getConversions(this.job.id),s=m.getBaseStats(this.playerLevel,this.job.id),o=m.getHeroStats(this.heroLevel);this.newGroup&&(this.oldGroupName=this.groupName,i.importGroup(this.groupName,[])),i.renameSavedGroup(this.oldGroupName,this.groupName,this.enemyLevel,this.playerLevel,this.heroLevel,this.job,this.damageType,this.element,this.secondaryElement,e,n,a,s,o),t.path("/build/"+this.groupName)},this.setHeroStats=function(){this.heroStats=m.getHeroStats(this.heroLevel)},a(function(){var e=document.getElementById("groupNameInput");e&&(e.focus(),e.setSelectionRange(0,9999))})}]),angular.module("dnsim").controller("quickAddCtrl",["$timeout","statHelper","saveHelper","quickAdd","itemCategory","jobs","dntData","exportLinkHelper",function(e,t,n,a,i,s,o,r){"use strict";var l=this;l.startedForCat="",l.stepNumber=0,l.datas=[],l.options=[],this.setOptions=function(){l.hasStarted()&&(l.options=a.getOptions(l.category,l.build,l.datas),1==l.options.length&&l.selectOption(l.options[0]))},this.selectOption=function(e){var t=a.createData(e,l.category,l.stepNumber);if(l.datas.push(t),l.stepNumber++,a.isValidStepNumber(l.category,l.stepNumber))l.setOptions();else{var n=a.getItem(l.datas),i=r.getDntFiles(n);angular.forEach(i,function(e,t){o.init(t,e,function(){},function(){l.tryToAddItem(i,n)})}),l.tryToAddItem(i,n)}},this.tryToAddItem=function(e,t){if(!o.anyLoading()){var a=!0;if(angular.forEach(e,function(e,t){o.isLoaded(t)||(a=!1)}),a&&l.datas.length>0){l.cancel();var i=r.reloadItem(t);n.saveItem(l.buildName,i),l.build.items.push(i),l.onChange()}}},this.reset=function(){l.stepNumber=0,l.datas=[],e(function(){l.setOptions()})},this.hasStarted=function(){return l.startedForCat==l.category.name},this.start=function(){l.startedForCat=l.category.name,s.init(function(){},l.reset),o.init("exchange.lzjson",null,function(){},l.reset),i.init(l.category.name,l.reset)},this.hasOptions=function(){return a.hasOptions(l.category,l.build,[])},this.cancel=function(){l.startedForCat="",l.reset()},this.back=function(){if(0==l.stepNumber)l.cancel();else{do{l.stepNumber--,l.datas.pop();var e=a.getOptions(l.category,l.build,l.datas)}while(e.length<=1&&l.stepNumber>0);l.setOptions()}}}]).directive("dngearsimQuickAdd",function(){return{scope:!0,bindToController:{category:"=category",build:"=build",buildName:"=buildName",onChange:"&onChange"},controller:"quickAddCtrl",controllerAs:"quickAdd",templateUrl:"ui/builds/quick-add.html"}}),angular.module("dnsim").controller("ViewGroupCtrl",["$scope","$window","region","$location","$routeParams","saveHelper","dntData","$timeout","translations","dntReset","exportLinkHelper","groupHelper","jobs","character","statHelper","hCodeValues",function(e,t,n,a,i,s,o,r,l,m,u,c,d,h,p,f){"use strict";function g(){!o.anyLoading()&&l.isLoaded()&&d.isLoaded()&&r(function(){var t=e.buildName,n=e.build;e.job=d.getById(e.job.id),e.enemyStatCaps=h.getStatCaps(e.enemyLevel),e.playerStatCaps=h.getStatCaps(e.playerLevel),e.job&&(e.conversions=h.getConversions(e.job.id),e.baseStats=h.getBaseStats(e.playerLevel,e.job.id)),e.heroStats=h.getHeroStats(e.heroLevel);var a=c.reloadGroup(t,n);m(),e.savedItems={},e.build={items:a,lastUpdate:n.lastUpdate,enemyLevel:e.enemyLevel,playerLevel:e.playerLevel,heroLevel:e.heroLevel,job:e.job,damageType:e.damageType,element:e.element,secondaryElement:e.secondaryElement,enemyStatCaps:e.enemyStatCaps,playerStatCaps:e.playerStatCaps,conversions:e.conversions,baseStats:e.baseStats,heroStats:e.heroStats},e.savedItems[t]=e.build,e.stats=p.getBuildStats(e.build);var i=u.createGroupLink(e.buildName,e.build);e.build.shortUrl=sessionStorage.getItem(i)})}function v(){}if(document.body.className="saved-back",t.document.title="DN Gear Sim",n.setLocationByName(i.region),e.buildName="",e.build={},"g"in i&&"i"in i){e.buildName=i.g,e.enemyLevel=i.e,e.playerLevel=i.p,e.heroLevel=i.h,e.job={id:i.j},e.damageType=f.damageTypes[i.d],e.element=f.elements[i.t],e.secondaryElement=f.elements[i.s];var b=[],S=i.i;angular.forEach(S.split(","),function(e,t){var n=u.decodeItem(e);n.id>0&&b.push(n)}),e.build={},e.savedItems={},e.savedItems[e.buildName]=e.build,e.build.items=b,e.isLoading=!0,angular.forEach(c.getDntFiles(e.build),function(e,t){o.init(t,e,v,g)}),l.init(v,g),d.init(v,g),h.init(g),r()}e.anyItems=Object.keys(e.savedItems).length>0,e.copyGroup=function(){var t=s.importGroup(e.buildName,e.build.items);s.renameSavedGroup(t,t,e.enemyLevel,e.playerLevel,e.heroLevel,e.job,e.damageType,e.element,e.secondaryElement,e.enemyStatCaps,e.playerStatCaps,e.conversions,e.baseStats,e.heroStats),a.url("/build/"+t)}}]),angular.module("dnsim").filter("percentage",[function(){"use strict";function e(e){return"number"==typeof e?Math.round(100*e*100)/100+"%":e}return e.$stateful=!1,e}]),angular.module("dnsim").controller("groupAssignmentCtrl",["hCodeValues","statHelper","saveHelper","itemCategory","$scope",function(e,t,n,a,i){"use strict";function s(e,t){return e&&t?Math.round(1e4*(1-t/e))/100:0}function o(){n.saveBuildSelection(r.groupName,r.savedItems)}var r=this;if(this.savedItems=n.getSavedItems(),this.groupNames=Object.keys(this.savedItems),this.groupNames||(this.groupNames=[]),this.groupNames.length>0?this.groupName=n.getCurrentBuild():this.groupName=null,this.groupName&&this.groupName in this.savedItems||this.groupNames.length>0&&(this.groupName=this.groupNames[0]),this.groupName){this.summaryStatIds=[];for(var l in e.stats)e.stats[l].summaryDisplay&&this.summaryStatIds.push(l);this.clearGroup=function(){r.addAffectAmount=null,r.replaceAffectAmount={},r.groupItems=null,r.groupCalcStats=null},i.$watch("editCtrl.item",function(){r.clearGroup()}),this.getAddAffectAmount=function(e){return this.initAddAffects(),this.addAffectAmount[e]},this.getReplaceAffectAmount=function(e,t,n){return this.initReplaceAffects(t,n),this.replaceAffectAmount[t][e]},this.getGroupCalcStats=function(){if(null==this.groupCalcStats){var e=r.savedItems[r.groupName];e&&(this.groupCalcStats=this.getCalculatedStats(e,e.items))}return this.groupCalcStats},this.getBuild=function(){return r.savedItems[r.groupName]},this.getCalculatedStats=function(n,a){var i=t.getNakedStats(n),s=t.getCombinedStats(a),o=t.getSetStats(a),r=i.concat(s).concat(o);return null!=n.heroStats&&n.heroStats.length>0&&(r=r.concat(n.heroStats)),r=e.mergeStats(r),t.getCalculatedStats(n,r)},this.initAddAffects=function(){if(!r.addAffectAmount){var t=r.getGroupCalcStats(),n=r.savedItems[r.groupName],a=[];n.items&&(a=n.items.concat([r.item]));var i=r.getCalculatedStats(n,a);this.addAffectAmount={};for(var o in e.stats)e.stats[o].summaryDisplay&&(r.addAffectAmount[o]=s(r.getStat(o,i).max,r.getStat(o,t).max))}},this.initReplaceAffects=function(t,n){if(!r.replaceAffectAmount[t]){var a=r.savedItems[r.groupName],i=[r.item];angular.forEach(a.items,function(e,t){n!==e&&i.push(e)});var o=r.getCalculatedStats(a,i),l=r.getGroupCalcStats();this.replaceAffectAmount[t]={};for(var m in e.stats)e.stats[m].summaryDisplay&&(r.replaceAffectAmount[t][m]=s(r.getStat(m,o).max,r.getStat(m,l).max))}},this.getStat=function(e,t){for(var n=t.length,a=0;a<n;++a)if(t[a].id==e)return t[a];return{id:e,max:0}},this.getStatName=function(t){var n="";if("primary"==e.stats[t].element){var a=0;r.savedItems[r.groupName].element&&(a=r.savedItems[r.groupName].element.id),n+=e.elements[a].name}else if("secondary"==e.stats[t].element){var a=0;r.savedItems[r.groupName].secondaryElement&&(a=r.savedItems[r.groupName].secondaryElement.id),n+=e.elements[a].name}return n+" "+e.stats[t].name},this.getGroupItems=function(){function e(e){if(e){for(var n=0,a=0;a<t.length;++a)e.indexOf(t[a])>0&&n++;return n}return-1}var t;if(null==r.groupItems&&r.groupName&&r.groupName in r.savedItems&&r.item&&r.item.typeName){r.groupItems=[];var n=[];angular.forEach(r.savedItems[r.groupName].items,function(e,t){e.exchangeType&&"gem"!=e.itemSource&&"plate"!=e.itemSource?e.exchangeType==r.item.exchangeType&&n.push(e):e.typeName==r.item.typeName&&n.push(e)}),r.item.name&&(t=r.item.name.split(" ")),n.sort(function(t,n){return e(n.name)-e(t.name)}),angular.forEach(n,function(e,t){e.name==r.item.name&&r.groupItems.push(e)}),angular.forEach(n,function(e,t){e.name!=r.item.name&&r.groupItems.push(e)})}return r.groupItems},this.hasMaxExchangable=function(){var e=a.byName(this.item.typeName),t=this.getGroupItems();if(e&&e.maxCat&&t.length>=e.maxCat)return!0;if(e&&e.maxExchange&&t.length>=e.maxExchange){for(var n=0;n<t.length;++n)if(!t[n].exchangeType)return!1;return!0}return!1},this.nextGroup=function(){var e=!1,t=null;angular.forEach(r.groupNames,function(n,a){e&&null==t&&(t=n),n==r.groupName&&(e=!0)}),null==t&&(t=r.groupNames[0]),r.groupName=t,o(),r.clearGroup()},this.prevGroup=function(){var e=!1,t=null;angular.forEach(r.groupNames,function(n,a){n==r.groupName&&(e=!0),e||(t=n)}),null==t&&(t=r.groupNames[r.groupNames.length-1]),r.groupName=t,o(),r.clearGroup()},this.addToGroup=function(){n.saveItem(r.groupName,r.item),this.savedItems=n.getSavedItems(),r.clearGroup()},this.replace=function(e){e.replaceItem=!0;var t=[];angular.forEach(r.savedItems[r.groupName].items,function(e,n){e.replaceItem?t.push(r.item):t.push(e)}),n.updatedSavedItems(r.groupName,t),this.savedItems=n.getSavedItems(),r.clearGroup()}}}]).directive("dngearsimGroupAssignment",function(){return{scope:!0,bindToController:{item:"=item"},controller:"groupAssignmentCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/group-assignment.html"}}),angular.module("dnsim").controller("itemEditCustomCtrl",["hCodeValues","$scope",function(e,t){"use strict";if(null!=this.item&&"custom"==this.item.itemSource){var n=this;this.statMap={},_.forEach(n.item.stats,function(e){n.statMap[e.id]=e.max});for(var a in e.stats)t.$watch("editCtrl.statMap["+a+"]",function(e,t){if(e!=t){var a=!1,i=[];for(var s in n.statMap)if(n.statMap[s]&&Number(n.statMap[s])){i.push({id:Number(s),max:Number(n.statMap[s])});var o=!1;_.each(n.item.stats,function(e){e.id==s&&(o=!0,s in n.statMap&&e.max==n.statMap[s]||(a=!0))}),o||(a=!0)}else _.each(n.item.stats,function(e){e.id==s&&(a=!0)});a&&(n.item.stats=i,n.onChange())}})}}]).directive("dngearsimItemEditCustom",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditCustomCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-custom.html"}}),angular.module("dnsim").controller("itemEditEnchantmentCtrl",["dntData","hCodeValues","items","$timeout","translations",function(e,t,n,a,i){"use strict";if(null!=this.item&&("itemSource"in this.item&&(this.itemType=n[this.item.itemSource]),this.itemType&&"enchantDnt"in this.itemType)){var s=this;s.enchantments=null,s.enchantment=null,s.enchantmentAfter=null,s.enchantmentCost="",s.enhancementOptions=[],null==s.item.enchantmentStats&&(s.item.enchantmentStats=[]),this.setEnchantment=function(){if(s.item.enchantmentStats=[],s.enchantments&&s.enchantments.length>0){"number"!=typeof s.item.enchantmentNum&&(s.item.enchantmentNum=6,s.onChange());for(var e=0;e<s.enchantments.length;++e)s.item.enchantmentNum==s.enchantments[e].EnchantLevel?(s.enchantment=s.enchantments[e],s.item.enchantmentStats=t.getStats(s.enchantment)):s.item.enchantmentNum+1==s.enchantments[e].EnchantLevel&&(s.enchantmentAfter=s.enchantments[e],s.enchantmentAfter.NeedCoin<1e4?s.enchantmentCost=Math.round(s.enchantmentAfter.NeedCoin/1e3)/10+"g":s.enchantmentCost=Math.round(s.enchantmentAfter.NeedCoin/1e4)+"g")}},this.isMaxEnchantLevel=function(){if(null!=s.enchantments&&s.enchantments.length>0&&"number"==typeof s.item.enchantmentNum){for(var e=0;e<s.enchantments.length;++e)if(s.item.enchantmentNum+1==s.enchantments[e].EnchantLevel)return!1;return!0}return!1},this.setEnchantmentNum=function(e){s.item.enchantmentNum=e,s.enhancementOptions=[],s.setEnchantment(),s.onChange()},this.nextEnchantment=function(){for(var e=s.item.enchantmentNum;0==e||s.enchantments[e-1];++e)0==e?s.enhancementOptions.push({number:0}):s.enhancementOptions.push(s.getOption(s.enchantments[e-1]))},this.prevEnchantment=function(){s.enhancementOptions=[];for(var e=s.item.enchantmentNum;e>0;--e)s.enhancementOptions.push(s.getOption(s.enchantments[e-1]));s.enhancementOptions.push({number:0})},this.getOption=function(e){return{number:e.EnchantLevel,stats:t.getStats(e)}},this.getEnchantments=function(){if(!s.enchantments&&s.item&&s.item.enchantmentId&&e.isLoaded(s.itemType.enchantDnt)){var t=s.item.enchantmentId;s.enchantments=e.find(s.itemType.enchantDnt,"EnchantID",t),s.setEnchantment()}return s.enchantments};var o="all-items.lzjson";this.showMaterials=function(){e.init(o,null,function(){},function(){a(function(){if(s.enchantmentAfter){s.materials=[];for(var t=1;t<=5;++t){var n=s.enchantmentAfter["NeedItemID"+t],a=s.enchantmentAfter["NeedItemCount"+t];if(n>0&&a>0){var r=e.find(o,"id",n);if(0==r.length)s.materials.push({num:a,name:"unknown ("+n+")"});else{var l=r[0],m=i.translate(l.NameID,l.NameIDParam);if(l){var u={num:a,icon:l.IconImageIndex,rank:l.Rank,levelLimit:l.LevelLimit,name:m};s.materials.push(u)}}}}}})})},e.isLoaded(o)&&this.showMaterials()}}]).directive("dngearsimItemEditEnchantment",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditEnchantmentCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-enchantment.html"}}),angular.module("dnsim").controller("itemEditPotentialCtrl",["dntData","items","hCodeValues",function(e,t,n){"use strict";function a(){var e={},t=null;return null!=i.potentials&&angular.forEach(i.potentials,function(a,i){var s=[];angular.forEach(n.getStats(a),function(e,t){n.stats[e.id].hide||s.push(e)}),s.length>0?e[a.id]=s:t||(e[a.id]=[],t=a.id)}),e}if(this.potentials=null,this.potential=null,this.changingPotentials=!1,this.potentialStats={},null!=this.item&&("itemSource"in this.item&&(this.itemType=t[this.item.itemSource]),this.itemType&&this.item.pid&&"potentialDnt"in this.itemType)){var i=this;this.getPotentials=function(){if(!i.potentials&&i.item&&i.item.pid&&"potentialDnt"in i.itemType){var t=e.find(i.itemType.potentialDnt,"id",i.item.pid);1==t.length?(i.potential=t[0],i.potentials=e.find(i.itemType.potentialDnt,"PotentialID",i.potential.PotentialID),i.potentialStats=a(i.potentials)):"potentialDntEx"in i.itemType&&(t=e.find(i.itemType.potentialDntEx,"id",i.item.pid),1==t.length&&(i.potential=t[0],i.potentials=e.find(i.itemType.potentialDntEx,"PotentialID",i.potential.PotentialID),i.potentialStats=a(i.potentials)))}return i.potentials},this.nextPotential=function(){for(var e=0;e<i.potentials.length;++e)if(i.potential.id==i.potentials[e].id)return i.potential=i.potentials[e+1],i.item.pid=i.potential.id,i.onChange(),void(this.changingPotentials=!0)},this.prevPotential=function(){for(var e=0;e<i.potentials.length;++e)if(i.potential.id==i.potentials[e].id)return i.potential=i.potentials[e-1],i.item.pid=i.potential.id,i.onChange(),void(this.changingPotentials=!0)},this.changePotential=function(e){for(var t=0;t<i.potentials.length;++t)if(e==i.potentials[t].id)return i.potential=i.potentials[t],i.item.pid=i.potential.id,i.changingPotentials=!1,void i.onChange()},this.isFirstPotential=function(){return this.getPotentials(),!i.potentials||i.potentials.length<=1||!i.potential||i.potential.id==i.potentials[0].id},this.isLastPotential=function(){return this.getPotentials(),!i.potentials||i.potentials.length<=1||!i.potential||i.potential.id==i.potentials[i.potentials.length-1].id}}}]).directive("dngearsimItemEditPotential",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditPotentialCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-potential.html"}}),angular.module("dnsim").controller("itemEditSkillCtrl",["$timeout","dntData","statHelper",function(e,t,n){"use strict";function a(e){}if(null!=this.item&&"skills"==this.item.itemSource){this.item.enchantmentNum||(this.item.enchantmentNum=1);var i=this;this.initSkills=function(){var n="skillleveltable_character"+i.item.baseJobName+i.item.pve+".lzjson";t.init(n,null,a,function(){e(function(){i.skillData=t.find(n,"SkillIndex",i.item.id)})})},this.nextEnchantment=function(){this.skillData&&this.item.enchantmentNum<this.skillData.length&&(this.item.enchantmentNum++,i.onChange())},this.isMaxSkillLevel=function(){return this.skillData&&this.item&&this.item.enchantmentNum>=this.skillData.length},this.prevEnchantment=function(){this.item.enchantmentNum>0?this.item.enchantmentNum--:this.item.enchantmentNum=0,i.onChange()},this.initSkills()}}]).directive("dngearsimItemEditSkill",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"
},controller:"itemEditSkillCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-skill.html"}}),angular.module("dnsim").controller("itemEditSparkCtrl",["dntData","hCodeValues","items",function(e,t,n){"use strict";function a(){var e=-1;return i.item.sparkId>0&&angular.forEach(i.sparks,function(t,n){if(t.id==i.item.sparkId)return void(e=n)}),e}if(null!=this.item){"itemSource"in this.item&&(this.itemType=n[this.item.itemSource]),this.sparks=null;var i=this;this.nextSpark=function(){var e=a();e++,e>=i.sparks.length&&(e=0);var n=i.sparks[e];i.item.sparkId=n.id,i.item.sparkStats=t.getStats(n),i.onChange()},this.isMoreSparks=function(){return null!=i.sparks&&a()>=i.sparks.length-1},this.isFirstSpark=function(){return 0==a()},this.prevSpark=function(){var e=a();e--,e<0&&(e=i.sparks.length-1);var n=i.sparks[e];i.item.sparkId=n.id,i.item.sparkStats=t.getStats(n),i.onChange()},this.removeSpark=function(){i.item.sparkId=null,i.item.sparkStats=null,i.onChange()},this.getSparks=function(){if(null==i.item)return null;if(null==i.sparks){var t=i.item.sparkTypeId;t&&e.isLoaded(i.itemType.sparkDnt)&&(i.sparks=e.find(i.itemType.sparkDnt,"PotentialID",t))}return i.sparks}}}]).directive("dngearsimItemEditSpark",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditSparkCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-spark.html"}}),angular.module("dnsim").controller("itemEditTalismanCtrl",[function(){"use strict";null!=this.item&&"tman"==this.item.itemSource&&(this.setTalisman=function(e){if(0==e)this.item.enchantmentNum=null,this.item.enchantmentStats=[];else{this.item.enchantmentNum=e;var t=[];angular.forEach(this.item.stats,function(n,a){t.push({id:n.id,max:n.max*(e/100)})}),this.item.enchantmentStats=t}this.onChange()})}]).directive("dngearsimItemEditTalisman",function(){return{scope:!0,bindToController:{item:"=item",onChange:"&onChange"},controller:"itemEditTalismanCtrl",controllerAs:"editCtrl",templateUrl:"ui/item/item-edit-talisman.html"}}),angular.module("dnsim").controller("itemViewBoxCtrl",["$timeout","dntData","itemFactory",function(e,t,n){"use strict";if(null!=this.item){if(46!=this.item.typeId&&8!=this.item.typeId&&112!=this.item.typeId)return void console.log("not box item type "+this.item.typeId);var a,i=this,s=["itemdroptable.lzjson","itemdroptable_abyss.lzjson","itemdroptable_apprentice.lzjson","itemdroptable_cook.lzjson","itemdroptable_darklair.lzjson","itemdroptable_dimension.lzjson","itemdroptable_disjoint.lzjson","itemdroptable_dnexpedition.lzjson","itemdroptable_event.lzjson","itemdroptable_farm.lzjson","itemdroptable_fishing.lzjson","itemdroptable_guildwar.lzjson","itemdroptable_item.lzjson","itemdroptable_monsteritem.lzjson","itemdroptable_propdrop.lzjson","itemdroptable_pvp.lzjson","itemdroptable_randomcompound.lzjson","itemdroptable_stageclear.lzjson","itemdroptable_themepark.lzjson","itemdroptable_union.lzjson"],o="all-items.lzjson",r="charmitemtable.lzjson",l="charmitemtable_common.lzjson";46==this.item.typeId||112==this.item.typeId?a=[o,r,l]:8==this.item.typeId&&(a=[o].concat(s));for(var m=0;m<a.length;++m)t.init(a[m],null,function(){},function(){e(function(){i.initBoxContents()})});this.initBoxContents=function(){console.log("init contents",this.item.fileName);for(var e=0;e<a.length;++e)if(!t.isLoaded(a[e]))return;var n=t.find(this.item.fileName+".lzjson","id",this.item.id);if(n.length>0){var s=n[0];i.items=[],46==i.item.typeId||112==i.item.typeId?i.getCharmItems(s.TypeParam1):8==i.item.typeId&&i.getPouchItems(s.TypeParam1)}},this.getPouchItems=function(e){for(var t=0;t<s.length;++t)i.getPouchItemsFromFile(e,s[t])},this.getPouchItemsFromFile=function(e,a){var s=t.find(a,"id",e);if(0==s.length);else{var r=s[0].GoldMin,l=0;do{l++;var m=s[0]["IsGroup"+l],u=s[0]["Item"+l+"Index"],c=s[0]["Item"+l+"Info"];if(u)if(m)i.getPouchItems(u,a);else{var d=t.find(o,"id",u);if(d.length>0){var h=n.createBasicItem(d[0]);i.items.push({count:c,gold:r,item:h})}}}while(u)}},this.getCharmItems=function(e){for(var a=[r,l],s=0;s<a.length;++s){var m=t.getData(a[s]);console.log("box: "+e,m);for(var u=0;u<m.length;++u){var c=m[u];if(c.CharmNum==e&&c.Look){var d=t.find(o,"id",c.ItemID);d.length>0&&i.items.push({count:c.Count,gold:c.Gold,item:n.createBasicItem(d[0])})}}}}}}]).directive("dngearsimItemViewBox",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewBoxCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-box.html"}}),angular.module("dnsim").controller("itemViewCraftCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(e,t,n,a,i){"use strict";if(null!=this.item){var s=this;s.crafts=[];for(var o=["itemcompoundtable.lzjson","itemcompoundtable_custom.lzjson","itemcompoundtable_glyph.lzjson","itemcompoundtable_jewel.lzjson","itemcompoundtable_renewal.lzjson","itemcompoundtable_set.lzjson"],r="all-items.lzjson",l=o.concat([r]),m=0;m<l.length;++m)t.init(l[m],null,function(){},function(){e(function(){s.initCrafts()})});this.initCrafts=function(){for(var e=0;e<l.length;++e)if(!t.isLoaded(l[e]))return;s.crafts=[];for(var e=0;e<o.length;++e)s.initCraft(o[e]);for(var n=[],e=0;e<s.crafts.length;++e){for(var a=!1,i=0;i<n.length;++i)if(s.crafts[e].gold==n[i].gold&&s.crafts[e].items.length==n[i].items.length){a=!0;for(var r=0;r<s.crafts[e].items.length;++r)s.crafts[e].items[r].item.id==n[i].items[r].item.id&&s.crafts[e].items[r].num==n[i].items[r].num||(a=!1)}a||n.push(s.crafts[e])}s.crafts=n},this.initCraft=function(e){for(var a=t.find(e,"SuccessItemID1",s.item.id),i=0;i<a.length;++i){for(var o=a[i],l={id:o.id,fileName:e.replace(".lzjson",""),gold:o.Cost/100/100,items:[]},m=0;;){m++;var u="Slot"+m+"Id",c="Slot"+m+"Num";if(!(u in o))break;var d=t.find(r,"id",o[u]);d.length>0&&l.items.push({item:n.createBasicItem(d[0]),num:o[c]})}s.crafts.push(l)}}}}]).directive("dngearsimItemViewCraft",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewCraftCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-craft.html"}}),angular.module("dnsim").controller("itemViewExtractionCtrl",["$timeout","dntData","itemFactory","items",function(e,t,n,a){"use strict";if(null!=this.item){for(var i=this,s="itemdroptable_disjoint.lzjson",o="all-items.lzjson",r=[s,o],l=0;l<r.length;++l)t.init(r[l],null,function(){},function(){e(function(){i.initExtract()})});this.initExtract=function(){for(var e=0;e<r.length;++e)if(!t.isLoaded(r[e]))return;var s,o=n.getItemData(i.item);o&&o.DisjointDrop1>0&&(s=o.DisjointDrop1);var l=a[i.item.itemSource];if(l&&o.EnchantID)for(var m=t.find(l.enchantDnt,"EnchantID",o.EnchantID),e=0;e<m.length;++e)if(m[e].EnchantLevel==i.item.enchantmentNum){s=m[e].DisjointDrop;break}i.items=[],s&&i.getItems(s)},this.getGold=function(){var e=n.getItemData(this.item);return Number(e.Disjointamount)/100/100},this.getItems=function(e){var a=t.find(s,"id",e);if(0==a.length);else{var r=a[0].GoldMin,l=0;do{l++;var m=a[0]["IsGroup"+l],u=a[0]["Item"+l+"Index"],c=a[0]["Item"+l+"Info"];if(u)if(m)i.getItems(u);else{var d=t.find(o,"id",u);d.length>0&&i.items.push({count:c,gold:r,item:n.createBasicItem(d[0])})}}while(u)}}}}]).directive("dngearsimItemViewExtraction",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewExtractionCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-extraction.html"}}),angular.module("dnsim").controller("itemViewPlateCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(e,t,n){"use strict";function a(){for(var e=t.find(s,"ItemID",i.item.id),a=0;a<e.length;++a)for(var r=e[a],l=0;;){l++;var m="CompoundTableIndex"+l;if(!(m in r))break;var u=t.find(o,"id",r[m]);u.length>0&&i.items.push(n.createBasicItem(u[0]))}}if(null!=this.item){var i=this;i.items=[];for(var s="platetable.lzjson",o="all-items.lzjson",r=[s,o],l=0;l<r.length;++l)t.init(r[l],null,function(){},function(){e(function(){i.initSets()})});this.initSets=function(){for(var e=0;e<r.length;++e)if(!t.isLoaded(r[e]))return;i.items=[],a()}}}]).directive("dngearsimItemViewPlate",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewPlateCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-plate.html"}}),angular.module("dnsim").controller("itemViewSetCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(e,t,n){"use strict";function a(e){for(var a=t.find(e,"SetItemID",i.item.setId),s=0;s<a.length;++s){var r=t.find(o,"id",a[s].id);r.length>0&&i.items.push(n.createBasicItem(r[0]))}}if(null!=this.item){var i=this;i.items=[];for(var s=["partstable.optimised.lzjson","partstable_cash.optimised.lzjson","partstable_common2014.optimised.lzjson","partstable_common2015.optimised.lzjson","partstable_common2016.lzjson","partstable_commoncash.lzjson","partstable_equipment.optimised.lzjson","partstable_event.lzjson","partstable_guild.lzjson","partstable_pvp.optimised.lzjson","partstable_reboot.optimised.lzjson","partstable_skilllevelup.lzjson","weapontable.optimised.lzjson","weapontable_cash.optimised.lzjson","weapontable_common2014.optimised.lzjson","weapontable_common2015.optimised.lzjson","weapontable_common2016.lzjson","weapontable_commoncash.lzjson","weapontable_equipment.optimised.lzjson","weapontable_event.lzjson","weapontable_guild.lzjson","weapontable_pvp.optimised.lzjson","weapontable_reboot.optimised.lzjson"],o="all-items.lzjson",r=s.concat([o]),l=0;l<r.length;++l)t.init(r[l],null,function(){},function(){e(function(){i.initSets()})});this.initSets=function(){for(var e=0;e<r.length;++e)if(!t.isLoaded(r[e]))return;i.items=[];for(var e=0;e<s.length;++e)a(s[e])}}}]).directive("dngearsimItemViewSet",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewSetCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-set.html"}}),angular.module("dnsim").controller("itemViewShopCtrl",["$timeout","dntData","itemFactory","hCodeValues","translations",function(e,t,n,a,i){"use strict";function s(e){for(var s=t.find(e,"itemindex",o.item.id),r=0;r<s.length;++r){var l=s[r],m=t.find(u,"id",l.PurchaseItem1),c=t.find(u,"id",l.PurchaseItem2),d={shopName:l.ShopID,tabName:i.translate(l.TabNameID),gold:0,nightmarePoints:0,ladderPoints:0,item1:n.createBasicItem(m[0]),item2:n.createBasicItem(c[0]),numItem1:0,numItem2:0};d.shopName in a.shopNames&&(d.shopName=a.shopNames[d.shopName]),1==l.PurchaseType1?d.gold+=l.PurchaseItemValue1:3==l.PurchaseType1?d.ladderPoints+=l.PurchaseItemValue1:8==l.PurchaseType1?d.nightmarePoints+=l.PurchaseItemValue1:d.numItem1=l.PurchaseItemValue1,1==l.PurchaseType2?d.gold+=l.PurchaseItemValue2:3==l.PurchaseType2?d.ladderPoints+=l.PurchaseItemValue2:8==l.PurchaseType2?d.nightmarePoints+=l.PurchaseItemValue2:d.numItem2=l.PurchaseItemValue2,d.gold=d.gold/100/100,o.shopCosts.push(d)}}if(null!=this.item){var o=this;o.shopCosts=[];for(var r="combinedshoptable.lzjson",l="combinedshoptable_system.lzjson",m="combinedshoptable_cash.lzjson",u="all-items.lzjson",c=[m,l,r,u],d=0;d<c.length;++d)t.init(c[d],null,function(){},function(){e(function(){o.initShops()})});this.initShops=function(){for(var e=0;e<c.length;++e)if(!t.isLoaded(c[e]))return;o.shopCosts=[],s(r),s(l),s(m);for(var n=[],e=0;e<o.shopCosts.length;++e){for(var a=!1,i=0;i<n.length;++i)if(o.shopCosts[e].tabName==n[i].tabName&&o.shopCosts[e].gold==n[i].gold&&o.shopCosts[e].item1.id==n[i].item1.id&&o.shopCosts[e].numItem1.id==n[i].numItem1.id&&o.shopCosts[e].item2.id==n[i].item2.id&&o.shopCosts[e].numItem2.id==n[i].numItem2.id){a=!0;break}a||n.push(o.shopCosts[e])}o.shopCosts=n}}}]).directive("dngearsimItemViewShop",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewShopCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-shop.html"}}),angular.module("dnsim").controller("itemViewTransferCtrl",["$timeout","dntData","itemFactory","hCodeValues",function(e,t,n,a){"use strict";if(null!=this.item){var i=this;i.matchingTransfers=[];for(var s="enchanttransfertable.lzjson",o="all-items.lzjson",r="enchanttransferitemtable.lzjson",l=[s,o,r],m=0;m<l.length;++m)t.init(l[m],null,function(){},function(){e(function(){i.initTransfers()})});this.initTransfers=function(){for(var e=0;e<l.length;++e)if(!t.isLoaded(l[e]))return;i.matchingTransfers=[];var m=t.find(r,"ItemID",i.item.id);if(m&&m.length>0)for(var u=t.find(s,"EnchantLevel",i.item.enchantmentNum),e=0;e<u.length;++e){var c=u[e];if(c.Rank==i.item.rank.id&&c.LevelLimit==i.item.levelLimit){var d=t.find(o,"id",c.NeedItemID1),h=t.find(o,"id",c.NeedItemID2);i.matchingTransfers.push({level:c.ResultLevel,enchantmentNum:c.ResultEnchantLevel,gold:c.NeedCoin/100/100,rank:a.rankNames[c.ResultRank],numItem1:c.NeedItemCount1,item1:n.createBasicItem(d[0]),numItem2:c.NeedItemCount2,item2:n.createBasicItem(h[0])})}}}}}]).directive("dngearsimItemViewTransfer",function(){return{scope:!0,bindToController:{item:"=item"},controller:"itemViewTransferCtrl",controllerAs:"ctrl",templateUrl:"ui/item/item-view-transfer.html"}}),angular.module("dnsim").controller("ItemCtrl",["$scope","$window","dntData","hCodeValues","items","jobs","exportLinkHelper","$routeParams","translations","$location","region","itemFactory","$timeout",function(e,t,n,a,i,s,o,r,l,m,u,c,d){"use strict";function h(){var t=s.getAllJobs();angular.forEach(t,function(t,n){if(t.id==e.item.needJobClass)return void(e.jobName=t.name)})}function p(){e.preInitItem=e.item,e.item=null;var t=!1;angular.forEach(o.getDntFiles(e.preInitItem),function(e,a){n.isLoaded(a)||(n.init(a,e,v,function(){f()}),t=!0)}),l.isLoaded()||(l.init(v,function(){f()}),t=!0),s.isLoaded()||(s.init(v,function(){f()}),t=!0),t||f()}function f(){if(!n.anyLoading()&&l.isLoaded()&&s.isLoaded()){if(e.item=o.reloadItem(e.preInitItem),null==e.item)return;g(),t.document.title="DN Gear Sim | "+e.item.name,"custom"!=e.item.itemSource&&("skills"==e.item.typeName&&(e.item.pve&&"pvp"==e.item.pve?e.item.pve="pvp":e.item.pve="pve"),e.item.needJobClass>0&&h(),e.item.fileName||e.item.itemSource in i&&i[e.item.itemSource].mainDnt&&(e.item.fileName=i[e.item.itemSource].mainDnt.replace(".lzjson","").replace(".optimised","")));var a=c.getItemData(e.item);a.DisjointDrop1>0&&(e.canExtract=!0),(0==a.Type||1==a.Type)&&e.item.enchantmentNum>0&&(e.canTransfer=!0),e.item.setId&&(e.isInSet=!0),5==e.item.typeId&&(e.isPlate=!0),null!=e.item.typeName&&112!=e.item.typeId?(e.canUse=!0,e.detail="use"):46==e.item.typeId||8==e.item.typeId||112==e.item.typeId?(e.hasContents=!0,e.detail="contents"):e.canExtract?e.detail="extract":e.canTransfer?e.detail="transfer":e.isPlate?e.detail="plate":e.detail="shops"}}function g(){e.item.fullStats=e.item.stats,null!=e.item.enchantmentStats&&e.item.enchantmentStats.length>0&&(e.item.fullStats=a.mergeStats(e.item.enchantmentStats,e.item.fullStats)),null!=e.item.sparkStats&&e.item.sparkStats.length>0&&(e.item.fullStats=a.mergeStats(e.item.sparkStats,e.item.fullStats))}function v(e){}u.setLocationByName(r.region),t.scrollTo(0,0),e.jobName=null,e.item=o.decodeItem(r.i),"itemSource"in e.item&&(e.itemType=i[e.item.itemSource]),e.item.setStats=null,e.item.setId=null,e.detail=null,e.getDescription=function(){if(e.item.description)return e.item.description;if(e.itemType&&"title"==e.itemType.name&&l.isLoaded()&&n.isLoaded(e.itemType.mainDnt)){var t=n.find(e.itemType.mainDnt,"id",e.item.id);if(t&&t.length>0&&t[0].DescriptionID>0)return l.translate(t[0].DescriptionID,t[0].DescriptionIDParam)}else if(e.item.fileName&&n.isLoaded(e.item.fileName+".lzjson")){var t=n.find(e.item.fileName+".lzjson","id",e.item.id);if(t&&t.length>0&&t[0].DescriptionID>0)return l.translate(t[0].DescriptionID,t[0].DescriptionIDParam)}return""},e.getExchangeType=function(){var t="exchange.lzjson";if(l.isLoaded()&&n.isLoaded(t)&&e.item.exchangeType>0){var a=n.find(t,"ExchangeType",e.item.exchangeType);if(a&&a.length>0&&a[0].NameID>0)return l.translate(a[0].NameID).toLowerCase()}return""},e.setDetail=function(t){e.detail=t},e.getServerStorage=function(){var t=c.getItemData(e.item);if(t&&"AbleWStorage"in t&&"IsCash"in t&&0==t.IsCash){if(1==t.AbleWStorage)return"can put in server storage";if(0==t.AbleWStorage)return"not transferable"}return""},e.handleChange=function(){"custom"!=e.item.itemSource?m.path("/item/"+u.dntLocation.region+"/"+o.encodeItem(e.item)):(g(),e.item=angular.copy(e.item))},p()}]),angular.module("dnsim").controller("ExportCtrl",["$scope","$window","saveHelper",function(e,t,n){"use strict";document.body.className="default-back",t.document.title="DN Gear Sim | EXPORT";var a=n.getSavedItems();e.exportData=JSON.stringify(a,null,1),e.save=function(){localStorage.setItem("savedItems",LZString.compressToUTF16(e.exportData))}}]),angular.module("dnsim").controller("NavCtrl",["$scope","$location","translations","region","itemCategory","saveHelper",function(e,t,n,a,i,s){"use strict";var o={path:"about",name:"",icon:"question-sign"},r=[o],l=[{path:"builds",name:"builds",icon:"wrench"},{path:"search",name:"gear",icon:"search"},{path:"items",name:"items",icon:"search"},o],m={path:"build",name:"build",icon:"wrench"},u=[{path:"builds",name:"builds",icon:"wrench"},m,{path:"search",name:"gear",icon:"search"},{path:"items",name:"items",icon:"search"},o];a.init(),e.isSearch=function(){return 0==t.path().indexOf("/search")},e.isLoading=function(){return n.startedLoading&&!n.isLoaded()&&null!=a.tlocation&&""!=a.tlocation.url&&!e.noRegion()},e.noRegion=function(){return null==a.dntLocation},e.fireAction=function(e){if("search"==e.name){var n=localStorage.getItem("selectedItemCategory",e.name);n?t.path("/"+e.path+"/"+n):t.path("/"+e.path)}else t.path("/"+e.path)},e.getActions=function(){var e=null,n=s.getCurrentBuild();if(n){var i=s.getSavedItems();n in i||(n=null)}return null!=a.dntLocation&&""==a.dntLocation.url?e=r:null!=a.tlocation&&""==a.tlocation.url?e=r:n&&"null"!=n?(e=u,m.path="build/"+n,m.name=n):e="/view-group"==t.path()||null==a.dntLocation?l:l,angular.forEach(e,function(e,n){delete e.extraCss,1==t.path().length?1==e.path.length&&(e.extraCss="active"):e.path.length>1&&0==t.path().indexOf("/"+e.path)&&("builds"==e.path&&"/builds"!=t.path()||(e.extraCss="active"))}),e}}]).directive("dngearsimNav",function(){return{templateUrl:"ui/nav/nav.html"}}),angular.module("dnsim").controller("SetupCtrl",["$scope","$window","$route","$timeout","translations","dntInit","dntReset","region",function(e,t,n,a,i,s,o,r){"use strict";function l(){u("current translations contain words like "+i.translate(329)+", "+i.translate(323)+" and "+i.translate(335)),e.isLoading=!1}function m(t){a(function(){null!=e.testResults&&e.testResults.push(t)})}function u(t){a(function(){null!=e.translationResults&&e.translationResults.push(t)})}document.body.className="default-back",t.document.title="DN Gear Sim | SETUP",e.advancedSetup=!1,e.isLoading=i.startedLoading&&!i.isLoaded(),e.translationResults=[],e.hostedFiles=r.hostedFiles;var c="",d=r.alternativeFiles.url;null==d&&(d=c),e.location=d,e.location==c?e.testResults=["No location set"]:e.testResults=["Using location "+e.location],e.setLocation=function(t){e.location=t,e.isLoading=!0,e.saveLocation(),o(),e.translationResults=[];var n=localStorage.getItem("UIStrings_file");null!=n&&n.indexOf(t)!=-1||sessionStorage.removeItem("UIStrings"),i.reset(),i.location=t,i.init(u,l)},e.resetSessionData=function(){e.testResults=["session data reset.. reloading page"],r.tlocation=null,r.dntLocation=null,i.reset(),sessionStorage.clear(),localStorage.clear(),this.saveLocation(),a(function(){location.hash="",location.reload(!0)})},e.loadUiString=function(){e.translationResults=[],sessionStorage.removeItem("UIStrings"),o(),i.reset(),i.location=r.tlocation.url,i.init(u,l)},e.saveLocation=function(){o(),e.location!=c&&(r.setCustomUrl(e.location),r.init(),r.alternativeFiles.region==r.tlocation.region&&(i.reset(),i.init(u,l)),e.testResults=["Location saved","Using location "+e.location])},e.testLocation=function(){e.location!=c&&(e.testResults=["Using location "+e.location,"Loading all data used by the app"],i.init(m,function(){s(m)}))}}]),function(){"use strict";function e(e,t,n,a,i){function s(){o.job&&a.getClassBuilds(o.job).then(function(e){e?o.jobBuilds=e:o.jobBuilds={}})}var o=this;o.maxDisplay=15,o.totalNumResults=0,i.init(null,function(){e.jobId&&(o.job=i.getById(e.jobId),s())}),this.setJob=function(){n(function(){t.path("/build-search/"+o.job.id)})},this.showMoreResults=function(e){o.maxDisplay=o.totalNumResults+e,o.totalNumResults=0},o.allResults=null,o.getFilteredBuilds=function(){if(null==o.allResults){o.allResults=[];for(var e in o.jobBuilds)for(var t in o.jobBuilds[e])o.allResults.push({uid:e,name:t,data:o.jobBuilds[e][t]})}for(var n=[],a=0;a<o.allResults.length;++a){var i=o.allResults[a];if(o.filter&&o.filter.length>0){var s=o.filter.toUpperCase();if(i.name.toUpperCase().indexOf(s)==-1&&(!i.data.guild||i.data.guild.toUpperCase().indexOf(s)==-1))continue}if(n.push(i),n.length>=o.maxDisplay)break}return o.totalNumResults=n.length,n}}angular.module("dnsim").controller("BuildSearchCtrl",["$routeParams","$location","$timeout","onlineService","jobs",e])}(),function(){"use strict";function e(e,t,n){function a(){n.getUserBuilds(s.uid).then(function(e){e?s.storedBuilds=e:s.storedBuilds={}})}function i(){n.getProfile(s.uid).then(function(e){e?s.profile=e:s.profile={}})}var s=this;s.uid=t.uid,a(),i(),this.openServer=function(t){e.path("/published/"+s.uid+"/"+t)},this.load=function(t,n){var a=saveHelper.importGroup(t,n.items);saveHelper.renameSavedGroup(a,a,n.enemyLevel,n.playerLevel,n.heroLevel,n.job,n.damageType,n.element,n.secondaryElement,n.enemyStatCaps,n.playerStatCaps,n.conversions,n.baseStats,n.heroStats),s.builds=saveHelper.getSavedItems(),e.path("/build/"+a)}}angular.module("dnsim").controller("ProfileCtrl",["$location","$routeParams","onlineService",e])}(),function(){"use strict";function e(e,t,n,a,i){function s(){var e=l.getUser();e&&n.getUserBuilds(e.uid).then(function(e){e?l.storedBuilds=e:l.storedBuilds={}})}function o(){var e=l.getUser();e&&n.getProfile(e.uid).then(function(e){e?l.profile=e:l.profile={}})}function r(e){console.log(e)}var l=this;l.show=a.show,n.login().then(function(e){s(),o(),l.builds=t.getSavedItems()}),this.saveProfile=function(){n.saveProfile(l.profile).then(o)["catch"](r)},this.getUser=function(){return n.getUser()},this.save=function(e,t){t.lastUpdate=(new Date).getTime(),n.saveBuild(e,t).then(s)["catch"](r),l.publishBuild=null},this.startPublish=function(e){e in l.storedBuilds&&(l.builds[e].region||(l.builds[e].region=l.storedBuilds[e].region),l.builds[e].about||(l.builds[e].about=l.storedBuilds[e].about),l.builds[e].guild||(l.builds[e].guild=l.storedBuilds[e].guild)),l.builds[e].region||(l.builds[e].region=i.dntLocation.region),l.publishBuild=e},this.deleteAccount=function(){n.deleteAccount(l.storedBuilds)},this.openLocal=function(t){e.path("/build/"+t)},this.openServer=function(t){e.path("/published/"+l.getUser().uid+"/"+t)},this.getBuildLimit=function(){return l.profile&&l.profile.maxBuilds?l.profile.maxBuilds:15},this.getNumStoredBuilds=function(){return _.size(l.storedBuilds)},this.getNumBuilds=function(){return _.size(l.builds)},this.load=function(e,n){var a=t.importGroup(e,n.items);t.renameSavedGroup(a,a,n.enemyLevel,n.playerLevel,n.heroLevel,n.job,n.damageType,n.element,n.secondaryElement,n.enemyStatCaps,n.playerStatCaps,n.conversions,n.baseStats,n.heroStats),l.builds=t.getSavedItems()},this.signOut=function(){n.signOut()},l.deleteLocal=function(e){l.localToDelete=e},l.getAllBuildNames=function(){var e=_.keys(l.builds).concat(_.keys(l.storedBuilds));return _.uniq(e.sort(),!0)},l.reallyDeleteLocal=function(e){t.updatedSavedItems(e,[]),l.localToDelete=null,l.builds=t.getSavedItems()},l.deleteServer=function(e){l.serverToDelete=e},l.reallyDeleteServer=function(e){n.deleteBuild(e,l.storedBuilds[e]).then(s),l.serverToDelete=null}}angular.module("dnsim").controller("PublishCtrl",["$location","saveHelper","onlineService","$routeParams","region",e])}(),function(){"use strict";function e(e,t,n,a,i){function s(){e.getProfile(r.uid).then(function(e){e?r.profile=e:r.profile={}})}function o(){e.getBuild(r.uid,r.buildName).then(function(e){e?(r.build=e,r.stats=i.getBuildStats(e)):r.build={}})}var r=this;r.uid=n.uid,r.buildName=n.buildName,o(),s(),r.copyLocally=function(){var e=a.importGroup(r.buildName,r.build.items);a.renameSavedGroup(e,e,r.build.enemyLevel,r.build.playerLevel,r.build.heroLevel,r.build.job,r.build.damageType,r.build.element,r.build.secondaryElement,r.build.enemyStatCaps,r.build.playerStatCaps,r.build.conversions,r.build.baseStats,r.build.heroStats),t.path("/build/"+e)}}angular.module("dnsim").controller("PublishedCtrl",["onlineService","$location","$routeParams","saveHelper","statHelper",e])}(),angular.module("dnsim").controller("RegionCtrl",["$scope","$timeout","$route","$routeParams","$location","translations","region",function(e,t,n,a,i,s,o){"use strict";o.init(),s.init(function(e){},function(){t()}),e.region=o,e.getDntLocation=function(){return o.dntLocation},e.getTlocation=function(){return o.tlocation},e.getHostedFiles=function(){return o.hostedFiles},e.getWorldName=function(){return s.isLoaded()?s.translate(10169):""},e.setTLocation=function(t){o.setTLocation(t),e.edit=!1},e.setLocation=function(t){a.region?(a.region=t.region,n.updateParams(a)):o.setLocation(t),e.edit=!e.edit}}]).directive("dngearsimRegion",function(){return{templateUrl:"ui/region/region.html"}}),function(){"use strict";function e(e,t,n,a,i,s){this.customItems=a.customItems,this.maxDisplay=10,this.currentResults=0,null==this.nameSearch&&(this.nameSearch=""),this.getResults=function(){return this.customItems},this.getNewStatName=function(){return""==this.nameSearch||null==this.nameSearch?"unnamed custom item":this.nameSearch},this.createCustomItem=function(){""!=this.nameSearch&&null!=this.nameSearch||(this.nameSearch=this.getNewStatName()),n.path("/item/_custom:."+this.nameSearch)}}angular.module("dnsim").directive("dngearsimCustomItems",function(){return{scope:{},bindToController:{},controller:["$window","saveHelper","$location","hCodeValues","itemCategory","$timeout",e],controllerAs:"customItems",templateUrl:"ui/search/custom-items.html"}})}(),angular.module("dnsim").controller("ItemSearchCtrl",["$scope","$window","$routeParams","$timeout","$location","translations","itemCategory","jobs","hCodeValues","itemFactory","region","saveHelper",function(e,t,n,a,i,s,o,r,l,m,u,c){"use strict";function d(){r.isLoaded()?p():r.init(h,function(){a(p)}),o.init(v.itemCategory.name,f)}function h(e){}function p(){if(s.isLoaded()&&r.isLoaded()){var e=r.getFinalJobs();e.splice(0,0,v.jobs[0]),v.jobs=e,v.allJobs=r.getAllJobs();var t=Number(localStorage.getItem("jobNumber"));null!=t&&angular.forEach(e,function(e,n){if(e.id==t)return void(v.job=e)})}}function f(){a(function(){v.maxDisplay=12,v.results=g()})}function g(){var e=o.getItems(v.itemCategory.name);if(null==e)return null;e=e.sort(function(e,t){return t.levelLimit-e.levelLimit});var t=-1;"pc"in v.stat&&(t=v.stat.pc);for(var n=[],a=[],i=e.length,s=0,r=0;r<i&&(s<v.maxDisplay||v.stat.id>=0);++r){var l=e[r];if(l){if(!v.itemCategory.hideLevel&&(l.levelLimit<v.minLevel||l.levelLimit>v.maxLevel))continue;if(!v.itemCategory.hideRank&&l.rank&&!v.rankChecked[l.rank.id])continue;if(!v.itemCategory.hideJob&&v.job&&v.job.id&&!v.job.isClassJob(l.needJobClass))continue;if(m.initItem(l),l.typeName!=v.itemCategory.name)continue;if(""!=v.nameSearch){var u=v.nameSearch.split(" ");u.length||(u=[v.nameSearch]);for(var c=!0,d=0;d<u.length;++d)if(l.name.toUpperCase().indexOf(u[d].toUpperCase())==-1){c=!1;break}if(!c)continue}if(v.stat.id>=0){for(var h=!1,p={},f=0;f<l.stats.length;++f){var g=l.stats[f];if(g.id==v.stat.id){h=!0,p.i=s,p.s=Number(g.max);break}g.id==t&&(h=!0,p.i=s,p.s=Number(g.max))}if(!h)continue;n.push(p)}a.push(l),s++}}if(v.stat.id>=0){var b=Math.min(s,v.maxDisplay);n=n.sort(function(e,t){return t.s-e.s});for(var S=[],r=0;r<b;++r)S.push(a[n[r].i]);a=S}return v.totalNumResults=a.length,a}var v=this;if(v.itemCategory=o.byPath("search/"+n.itemType),!v.itemCategory){var b=localStorage.getItem("selectedItemCategory");return b||(b="titles"),v.itemCategory=o.byName(b),void(v.itemCategory&&i.path(v.itemCategory.path))}t.document.title="DN Gear Sim | "+v.itemCategory.name.toUpperCase(),v.job={id:-1,name:""},v.jobs=[v.job],v.allJobs=[],v.minLevel=1,v.maxLevel=99,v.maxDisplay=10,v.totalNumResults=0,v.grades=l.rankNames,v.stat={id:-1,name:""},v.stats=[v.stat],v.results=null,angular.forEach(l.stats,function(e,t){e.searchable&&v.stats.push(e)});var S=Number(localStorage.getItem("minLevel"));S>0&&S<100&&(v.minLevel=S);var y=Number(localStorage.getItem("maxLevel"));y>0&&y<100&&(v.maxLevel=y),v.nameSearch=localStorage.getItem("nameSearch"),v.nameSearch||(v.nameSearch="");var I=localStorage.getItem("searchStat");I>-1&&I in l.stats&&(v.stat=l.stats[I]),v.navigate=function(){var e=localStorage.getItem("selectedItemCategory");e&&(v.itemCategory=o.byName(e),v.itemCategory&&i.path(v.itemCategory.path))},v.save=function(){v.itemCategory.hideLevel||(localStorage.setItem("minLevel",v.minLevel),localStorage.setItem("maxLevel",v.maxLevel)),v.itemCategory.hideJob||null!=v.job&&localStorage.setItem("jobNumber",v.job.id),v.stat&&localStorage.setItem("searchStat",v.stat.id),localStorage.setItem("nameSearch",v.nameSearch)},v.rankChecked=l.checkedRank,v.changeSearch=function(){v.save(),f()},v.showMoreResults=function(){a(function(){v.maxDisplay+=18,v.results=g()})},u.init(),s.isLoaded()?d():s.init(h,function(){a(d)})}]),function(){"use strict";function e(e,t,n,a,i,s,o,r,l,m){function u(e){return null!=e?"skilltable_character"+e.toLowerCase()+".lzjson":null}function c(){if(g.loadedJobId==g.job.id)return g.skills;var e=[];if(g.job.id>=0){var n=i.getBaseJobName(g.job);e.push(n)}angular.forEach(e,function(n,a){var i=u(n);i&&(o.isLoaded(i)?d(e,g.job):o.init(i,null,h,function(){t(function(){d(e,g.job)})}))})}function d(e,t){g.skills=[];var n=!0;angular.forEach(e,function(e,t){var a=u(e);o.isLoaded(a)||(n=!1)}),n&&(angular.forEach(e,function(e,t){for(var n=u(e),a=o.getData(n),i=a.length,l=0;l<i;++l)if(0!=a[l].NameID&&(a[l].EffectClass1>0||a[l].EffectClass2>0||a[l].EffectClass3>0||a[l].EffectClass4>0||a[l].EffectClass5>0||a[l].EffectClass6>0)){var m={d:a[l]};m.id=a[l].id,m.typeName="skills",m.itemSource="skills",m.name=s.translate(a[l].NameID,a[l].NameIDParam),m.needJobClass=a[l].NeedJob,m.rank=r.rankNames[0],m.baseJobName=e.toLowerCase(),m.icon=a[l].IconImageIndex,g.skills.push(m)}}),g.loadedJobId=t.id)}function h(e){}function p(){if(s.isLoaded()&&i.isLoaded()){var e=i.getFinalJobs();g.jobs&&g.jobs.length&&e.splice(0,0,g.jobs[0]),g.jobs=e,g.allJobs=i.getAllJobs();var t=Number(localStorage.getItem("jobNumber"));null!=t&&angular.forEach(e,function(e,n){if(e.id==t)return void(g.job=e)}),g.getResults()}}function f(){i.isLoaded()?t(p):i.init(h,function(){t(p)})}var g=this;g.allJobs=[],g.dntName="",g.skills=[],g.loadedJobId=-1,g.itemCategory=l.byName("skills"),g.nameSearch=localStorage.getItem("nameSearch"),g.nameSearch||(g.nameSearch=""),a.init(),s.isLoaded()?f():s.init(h,function(){t(f)}),g.navigate=function(){t(function(){g.itemCategory&&m.path(g.itemCategory.path)})},g.isLoading=function(){if(!s.isLoaded())return s.startedLoading||s.init(h,function(){}),!0;var e=i.getBaseJobName(g.job),t=u(e);return!(!t||o.isLoaded(t))},g.itemLinkClosed=function(){n.saveCustomItems(g.customItems),g.customItems=n.getCustomItems()},g.getResults=function(){var e=c();if(null==e)return[];g.job&&g.job.id>=0&&localStorage.setItem("jobNumber",g.job.id),localStorage.setItem("nameSearch",g.nameSearch);for(var t=[],n=e.length,a=0;a<n;++a){var i=e[a];if(""!=g.nameSearch){var s=g.nameSearch.split(" ");s.length||(s=[g.nameSearch]);for(var o=!0,r=0;r<s.length;++r)if(i.name&&i.name.toString().toUpperCase().indexOf(s[r].toUpperCase())==-1){o=!1;break}if(!o)continue}g.job.id>=0&&!g.job.isClassJob(i.needJobClass)||t.push(i)}return t}}angular.module("dnsim").directive("dngearsimSkillSearch",function(){return{scope:{},bindToController:{
job:"=job",jobs:"=jobs"},controller:["$window","$timeout","saveHelper","region","jobs","translations","dntData","hCodeValues","itemCategory","$location",e],controllerAs:"skillSearch",templateUrl:"ui/search/skill-search.html"}})}(),angular.module("dnsim").controller("ItemsCtrl",["$window","$timeout","hCodeValues","region","translations","dntData",function(e,t,n,a,i,s){"use strict";var o=this;o.boxes=null,o.maxDisplay=32,o.currentResults=0,o.results=null,o.nameSearch=localStorage.getItem("itemNameSearch"),null==o.nameSearch&&(o.nameSearch=""),e.document.title="DN Gear Sim | ITEM SEARCH";var r="all-items.lzjson";s.init(r,null,function(){},function(){t(function(){o.initBoxes()})}),o.initBoxes=function(){if(s.isLoaded(r)&&i.isLoaded()){o.boxes=[];for(var e=s.getData(r),a=0;a<e.length;++a){var l=e[a];if(l.NameID>0){var m={id:l.id,name:i.translate(l.NameID,l.NameIDParam),rank:n.rankNames[l.Rank],icon:l.IconImageIndex,levelLimit:l.LevelLimit,fileName:l.fileName};o.boxes.push(m)}}o.boxes=_.sortBy(o.boxes,"name"),t(function(){o.showMoreResults()})}},o.getResults=function(){if(null==o.boxes&&o.initBoxes(),null==o.boxes)return[];for(var e=[],t=o.boxes.length,n=0,a=0;a<t&&n<o.maxDisplay;++a){var i=o.boxes[a];if(""!=o.nameSearch){var s=o.nameSearch.split(" ");0==s.length&&(s=[o.nameSearch]);for(var r=!0,l=0;l<s.length;++l)if(i.name&&i.name.toString().toUpperCase().indexOf(s[l].toUpperCase())==-1){r=!1;break}if(!r)continue}e.push(i),n++}return o.totalNumResults=e.length,e},o.changeSearch=function(){localStorage.setItem("itemNameSearch",o.nameSearch),o.maxDisplay=64,o.results=o.getResults()},o.showMoreResults=function(){t(function(){o.maxDisplay+=18,o.results=o.getResults()})}}]),function(){"use strict";function e(){return{restrict:"E",scope:{},bindToController:{job:"=job",onSetJob:"&onSetJob"},templateUrl:"ui/widgets/choose-class.html",controllerAs:"ctrl",controller:["$window","$location","$routeParams","$timeout","saveHelper","dntData","jobs","hCodeValues","itemColumnsToLoad","character",t]}}function t(e,t,n,a,i,s,o,r,l,m){function u(e){}this.getFinalJobs=function(){for(var e=o.getFinalJobs(),t=[],n=0;n<e.length;++n)o.getBaseJobName(e[n])==this.bJob&&t.push(e[n]);return t},this.getBaseJobs=function(){return o.getBaseJobs()},this.getJobName=function(e){for(var t=o.getAllJobs(),n=0;n<t.length;++n)if(t[n].d.EnglishName==e)return t[n].name},this.setJob=function(e){this.job=e,e&&this.onSetJob()},o.init(u,a)}angular.module("dnsim").directive("dnsimChooseClass",e)}(),function(){"use strict";function e(e,n){return{restrict:"E",scope:{},bindToController:{collapse:"=collapse",cat:"=cat",onChange:"&onChange"},templateUrl:"ui/widgets/dnsim-category-links.html",controller:["itemCategory",t],controllerAs:"ctrl"}}function t(e){var t=this;t.categories=e.categories,t.collapsed=!0,t.setCategory=function(e){t.cat=e,localStorage.setItem("selectedItemCategory",e.name),t.collapse&&(t.collapsed=!t.collapsed),t.onChange&&t.onChange()}}angular.module("dnsim").directive("dnsimCategoryLinks",["itemCategory","$location",e])}(),function(){"use strict";function e(e,t,n){return{restrict:"E",scope:{item:"=item"},templateUrl:"ui/widgets/dnsim-item-icon.html",link:function(e,t,n){e.$watch("item",function(t,n){t&&(e.iconImage=e.getIcon())}),e.getIcon=function(){if(e.item&&e.item.icon>0){var t,n=Math.floor(e.item.icon/200+1);return t="skills"==e.item.typeName?"skillicon":"itemicon",n>9?t+n+".png":t+"0"+n+".png"}return null},e.iconImage=e.getIcon(),e.getIconXPostion=function(){return e.item&&e.item.icon>0?e.item.icon%10*40+5:0},e.getIconYPostion=function(){return e.item&&e.item.icon>0?40*Math.floor(e.item.icon%200/10)+4:0}}}}angular.module("dnsim").directive("dnsimItemIcon",["exportLinkHelper","$location","region",e])}(),function(){"use strict";function e(e,t,n){return{restrict:"E",scope:{item:"=item",noClick:"=noClick"},templateUrl:"ui/widgets/dnsim-item-link.html",link:function(a,i,s){a.itemLink="/item/"+n.dntLocation.region+"/"+e.encodeItem(a.item),a.$watch("item",function(t,i){t&&(a.itemLink="/item/"+n.dntLocation.region+"/"+e.encodeItem(a.item))}),a.openItem=function(){a.noClick||t.path(a.itemLink)}}}}angular.module("dnsim").directive("dnsimItemLink",["exportLinkHelper","$location","region",e])}(),function(){"use strict";function e(){return{restrict:"E",scope:{},bindToController:{item:"=item"},templateUrl:"ui/widgets/dnsim-job-icon.html",controller:t,controllerAs:"ctrl"}}function t(){this.getIconXPostion=function(){return this.item&&this.item.d&&this.item.d.JobIcon>0?this.item.d.JobIcon%9*44+5:0},this.getIconYPostion=function(){return this.item&&this.item.d&&this.item.d.JobIcon>0?44*Math.floor(this.item.d.JobIcon/9)+5:0}}angular.module("dnsim").directive("dnsimJobIcon",[e])}(),function(){"use strict";function e(e,t,n){return{restrict:"E",transclude:!0,scope:{alsoShowFor:"=alsoShowFor"},templateUrl:"ui/widgets/dnsim-loading.html",link:function(a,i,s){a.$on("TRANSLATION_LOAD_EVENT",function(){a.setLoadCount()}),a.$on("DNTDATA_LOAD_EVENT",function(){a.setLoadCount()}),a.$on("DNTDATA_LOAD_ERROR",function(){n(function(){a.loadError=!0})}),a.$on("TRANSLATION_LOAD_ERROR",function(){n(function(){a.loadError=!0})}),a.numLoading=0,a.setLoadCount=function(){var i=e.anyLoading();t.isLoaded()||i++,n(function(){(a.numLoading<i||!a.totalToLoad)&&(a.totalToLoad=i),a.numLoading=i})},a.setLoadCount(),a.loadError=!1}}}angular.module("dnsim").directive("dnsimLoading",["dntData","translations","$timeout",e])}(),function(){"use strict";function e(){return{restrict:"A",link:function(e,t,n){var a=!1;t.on("click",function(e){if(!a)try{this.selectionStart=0,this.selectionEnd=this.value.length+1,a=!0}catch(t){this.select(),a=!0}}),t.on("blur",function(e){a=!1})}}}angular.module("dnsim").directive("dnsimSelectAllOnClick",[e])}(),function(){"use strict";function e(e){return{restrict:"A",scope:{stats:"=stats",build:"=build",altStats:"=altStats",separator:"=separator",filter:"=filter"},link:function(t,n,a){function i(){function a(e){var t=n.clone();t.css("display",r),t.html(e),m.after(t),m=t,o.push(t)}n.css("display","none");var i=t.stats;i||(i=t.altStats),angular.forEach(o,function(e,t){e.remove()});var l=!0,m=n;angular.forEach(i,function(n,o){var r="";if(n.id in e.stats){var m=e.stats[n.id];if(!t.filter&&"hide"in m&&m.hide)return;if(t.filter&&!m[t.filter])return;if(l||(r+=s),l=!1,"needSetNum"in n&&(r+=n.needSetNum+"&nbsp;"),t.build)if("primary"==m.element){var u=0;t.build.element&&(u=t.build.element.id),r+=e.elements[u].name+"&nbsp;"}else if("secondary"==m.element){var u=0;t.build.secondaryElement&&(u=t.build.secondaryElement.id),r+=e.elements[u].name+"&nbsp;"}r+=m.name+":&nbsp;"+m.display(n),m.combineWith>0&&angular.forEach(i,function(e,t){if(e.id==m.combineWith)return void(e.max!=n.max&&(r+="-"+m.display(e)))})}else l||(r+=s),l=!1,"needSetNum"in n&&(r+=n.needSetNum+"-Increases&nbsp;"),r+=n.id+":&nbsp;"+n.max;a(r)})}var s;s=t.separator?"&nbsp;"+t.separator+" ":"";var o=[],r=n.css("display");t.$watch("stats",function(e,t){e&&i()}),t.$watch("altStats",function(e,t){e&&i()})}}}angular.module("dnsim").directive("dnsimStats",["hCodeValues",e])}(),function(){"use strict";function e(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return""+e}),a.$formatters.push(function(e){return parseFloat(e,10)})}}}angular.module("dnsim").directive("dnsimStringToNumber",e)}(),function(){"use strict";function e(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return""+e/100}),a.$formatters.push(function(e){return 100*parseFloat(e,10)})}}}angular.module("dnsim").directive("dnsimStringToPercent",e)}(),function(){"use strict";function e(e,t,n,a){function i(e){}var s="rebootplayerweighttable.lzjson",o="playercommonleveltable.lzjson",r="playerleveltable.lzjson",l="heroleveltable.lzjson",m="potentialtable_herolevel.lzjson";return{init:function(a){n.init(i,a),e.init(s,t.jobConversionColsToLoad,i,a),e.init(o,t.statCapColsToLoad,i,a),e.init(r,t.jobBaseStatColsToLoad,i,a),e.init(l,null,i,a),e.init(m,null,i,a)},getHeroStats:function(t){var n=[];if(t>0){var i=e.findFast(l,"id",t);if(1==i.length){var s=e.getRow(l,i[0]);if(s){var o=e.findFast(m,"PotentialID",s.HeroLevelAbilityID);if(1==o.length){var r=e.getRow(m,o[0]);r&&(n=a.getStats(r))}}}}return n},getStatCaps:function(t){if(t>0){var n=e.findFast(o,"id",t);if(1==n.length)return e.getRow(o,n[0])}return{}},getConversions:function(t){if(t>0){var n=e.findFast(s,"id",t);if(1==n.length)return e.getRow(s,n[0])}return{}},getBaseStats:function(t,n){if(t>0&&n>0){var a=e.findFast(r,"id",100*Number(n)+Number(t)-100);if(1==a.length)return e.getRow(r,a[0])}return{}}}}angular.module("dnsim").factory("character",["dntData","itemColumnsToLoad","jobs","hCodeValues",e])}(),function(){"use strict";function e(){return{mainDnt:{NameID:!0,DescriptionID:!0,NameIDParam:!0,DescriptionIDParam:!0,Type:!0,TypeParam1:!0,TypeParam2:!0,TypeParam3:!0,LevelLimit:!0,NeedJobClass:!0,Rank:!0,State1:!0,StateValue1:!0,State1_Max:!0,State1_GenProb:!0,State2:!0,StateValue2:!0,State2_Max:!0,State3:!0,StateValue3:!0,State3_Max:!0,State4:!0,StateValue4:!0,State4_Max:!0,State5:!0,StateValue5:!0,State5_Max:!0,State6:!0,StateValue6:!0,State6_Max:!0,State7:!0,StateValue7:!0,State7_Max:!0,State8:!0,StateValue8:!0,State8_Max:!0,State9:!0,StateValue9:!0,State9_Max:!0,State10:!0,StateValue10:!0,State10_Max:!0,EnchantID:!0,SkillID:!0,dragonjeweltype:!0,AbleWStorage:!0,ExchangeType:!0,IconImageIndex:!0,IsCash:!0,DisjointDrop1:!0,Disjointamount:!0},partsDnt:{SetItemID:!0},enchantDnt:{EnchantID:!0,EnchantLevel:!0,EnchantRatio:!0,BreakRatio:!0,MinDown:!0,MaxDown:!0,NeedCoin:!0,DisjointDrop:!0,NeedItemID1:!0,NeedItemCount1:!0,NeedItemID2:!0,NeedItemCount2:!0,NeedItemID3:!0,NeedItemCount3:!0,NeedItemID4:!0,NeedItemCount4:!0,NeedItemID5:!0,NeedItemCount5:!0,ProtectItemCount:!0,State1:!0,State1Value:!0,State2:!0,State2Value:!0,State3:!0,State3Value:!0,State4:!0,State4Value:!0,State5:!0,State5Value:!0,State6:!0,State6Value:!0,State7:!0,State7Value:!0,State8:!0,State8Value:!0,State9:!0,State9Value:!0,State10:!0,State10Value:!0},potentialDnt:{PotentialID:!0,PotentialNo:!0,PotentialRatio:!0,State1:!0,State1Value:!0,State2:!0,State2Value:!0,State3:!0,State3Value:!0,State4:!0,State4Value:!0,State5:!0,State5Value:!0,State6:!0,State6Value:!0,State7:!0,State7Value:!0,State8:!0,State8Value:!0,State9:!0,State9Value:!0,State10:!0,State10Value:!0,State11:!0,State11Value:!0,State12:!0,State12Value:!0,State13:!0,State13Value:!0,State14:!0,State14Value:!0,State15:!0,State15Value:!0,State16:!0,State16Value:!0},gemDnt:{Type:!0},setDnt:null,sparkDnt:null,jobsDnt:{JobName:!0,JobNumber:!0,BaseClass:!0,ParentJob:!0,EnglishName:!0,JobIcon:!0},jobBaseStatColsToLoad:{Strength:!0,Agility:!0,Intelligence:!0,Stamina:!0,AggroperPvE:!0,BaseMP:!0},statCapColsToLoad:{Cbase:!0,Cdefense:!0,Ccritical:!0,Cfinaldamage:!0,CcriticalDamage:!0},jobConversionColsToLoad:{HP:!0,StrengthAttack:!0,AgilityAttack:!0,IntelligenceAttack:!0,PhysicalDefense:!0,MagicDefense:!0,Critical:!0,CriticalResistance:!0,Stiff:!0,StiffResistance:!0,Stun:!0,StunResistance:!0,MoveSpeed:!0,MoveSpeedRevision:!0,DownDelay:!0,ElementAttack:!0,ElementDefense:!0,ElementDefenseMin:!0,ElementDefenseMax:!0,StrengthIntelligenceToCriticalDamage:!0}}}angular.module("dnsim").factory("itemColumnsToLoad",[e])}(),function(){"use strict";function e(e,t){function n(n,a,i){var s={reader:new DntReader,loaded:!1,startedLoading:!1,file:a,dntLocation:n,progressCallback:null,completeCallbacks:[],init:function(n,s){if(this.loaded)s();else if(this.progressCallback=n,this.completeCallbacks.push(s),!this.startedLoading){this.startedLoading=!0;var o=this;this.reader.colsToLoad=i,this.dntLocation&&this.dntLocation.url&&this.dntLocation.url.length&&(e.$broadcast("DNTDATA_LOAD_EVENT"),t(function(){o.reader.loadDntFromServerFile(o.dntLocation.url+"/"+a,function(e){null!=o.progressCallback&&o.progressCallback(e)},function(t,n){o.loaded=!0,angular.forEach(o.completeCallbacks,function(e,t){e()}),o.completeCallbacks=[],e.$broadcast("DNTDATA_LOAD_EVENT")},function(t){e.$broadcast("DNTDATA_LOAD_ERROR"),o.startedLoading=!1,o.loaded=!1})}))}},reset:function(){this.reader=new DntReader,this.loaded=!1,this.startedLoading=!1}};return s}return{loaders:{},findIndexes:{},dntLocation:null,setLocation:function(e){this.dntLocation=e;var t=this;angular.forEach(this.loaders,function(n,a){n.dntLocation!=e&&(n.dntLocation=e,t.reset(a))})},init:function(e,t,a,i){a||(a=function(){}),e in this.loaders||e.length>0&&(this.loaders[e]=n(this.dntLocation,e,t)),this.loaders[e].init(a,i)},getData:function(e){if(this.isLoaded(e)){for(var t=this.loaders[e].reader,n=new Array(t.numRows),a=0;a<t.numRows;++a)n[a]=t.getRow(a);return n}return[]},find:function(e,t,n){for(var a=this.findFast(e,t,n),i=[],s=a.length,o=0;o<s;++o)i.push(this.getRow(e,a[o]));return i},findFast:function(e,t,n){if(this.isLoaded(e)){e in this.findIndexes||(this.findIndexes[e]={});var a=this.loaders[e].reader,i=a.columnIndexes[t],s=this.findIndexes[e];if(!(t in s)){var o={};s[t]=o;for(var r=a.data,l=r.length,m=0;m<l;++m){var u=r[m],c=u[i];c in o?o[c].push(m):o[c]=[m]}}return n in s[t]?s[t][n]:[]}return[]},isLoaded:function(e){return e in this.loaders&&this.loaders[e].loaded},hasStartedLoading:function(e){return this.isLoaded(e)||e in this.loaders&&this.loaders[e].startedLoading},reset:function(e){e in this.loaders&&(this.loaders[e].reset(),delete this.loaders[e],delete this.findIndexes[e])},resetAll:function(){var e=this;angular.forEach(this.loaders,function(t,n){e.reset(n)})},anyLoading:function(){var e=0;return angular.forEach(this.loaders,function(t,n){!t.loaded&&t.startedLoading&&e++}),e},getNumRows:function(e){return this.isLoaded(e)?this.loaders[e].reader.numRows:0},getRow:function(e,t){return this.isLoaded(e)?this.loaders[e].reader.getRow(t):{}},lookupValue:function(e,t,n){return this.isLoaded(e)?t[this.loaders[e].reader.columnNames[n]]:null},convertData:function(e,t){return this.isLoaded(e)?this.loaders[e].reader.convertData(t):null},getValue:function(e,t,n){return this.isLoaded(e)?this.loaders[e].reader.getValue(t,n):null}}}angular.module("dnsim").factory("dntData",["$rootScope","$timeout",e])}(),function(){"use strict";function e(e,t,n,a){return function(a){function i(e){e<s.length?s[e].init(a,function(){s[e].isLoaded()&&("fileName"in s[e]&&a("dnt loaded: "+s[e].fileName),i(e+1))}):a("Full initialise complete")}a("starting init");var s=[t];angular.forEach(e,function(e,t){"all"!=t&&angular.forEach(e,function(e,t){if(t.indexOf("Dnt")==t.length-3){var a={init:function(t,a){n.init(e,null,t,a)},isLoaded:function(){return n.isLoaded(e)},fileName:e};s.push(a)}})}),i(0)}}angular.module("dnsim").factory("dntInit",["items","jobs","dntData","itemFactory",e])}(),function(){"use strict";function e(e,t,n){return function(){angular.forEach(e,function(e,t){e.reset()}),t.reset(),n.resetAll()}}angular.module("dnsim").factory("dntReset",["items","jobs","dntData",e])}(),function(){"use strict";function e(e,t,n,a,i,s,o,r,l,m){return{encodeItem:function(e,t){if(e){var n;return"custom"==e.typeName?(n="_custom",angular.forEach(e.stats,function(e,t){n+=t>0?"|":":C",n+=e.id.toString(36)+"="+e.max})):e.id&&(n="I"+e.id.toString(36)+":_","itemSource"in e?n+=e.itemSource:"itemTypeName"in e&&(n+=e.itemTypeName),(e.enchantmentNum||0==e.enchantmentNum)&&(n+=":E"+e.enchantmentNum.toString(36)),e.pid>0&&(n+=":P"+e.pid.toString(36)),e.sparkId>0&&(n+=":H"+e.sparkId.toString(36)),"skills"==e.typeName&&(n+=":J"+e.baseJobName),e.pve&&(n+=":V"+e.pve),e.fileName&&(n+=":F"+e.fileName)),e.name&&!t&&(n+=":."+e.name.replace(/ /g,"-").replace(/\//g," ")),n}return""},decodeItem:function(e){var n={};return e&&angular.forEach(e.split(":"),function(e,a){if("I"==e.charAt(0))n.id=parseInt(e.substr(1),36);else if("E"==e.charAt(0))n.enchantmentNum=parseInt(e.substr(1),36);else if("P"==e.charAt(0))n.pid=parseInt(e.substr(1),36);else if("S"==e.charAt(0))n.setId=parseInt(e.substr(1),36);else if("H"==e.charAt(0))n.sparkId=parseInt(e.substr(1),36);else if("J"==e.charAt(0))n.baseJobName=e.substr(1);else if("V"==e.charAt(0))n.pve=e.substr(1);else if("_"==e.charAt(0))n.itemSource=e.substr(1);else if("."==e.charAt(0))n.name=e.substr(1).replace("-"," ");else if("C"==e.charAt(0)){n.stats=[];var i=e.substr(1);angular.forEach(i.split("|"),function(e,t){var a=e.split("=");n.stats.push({id:parseInt(a[0],36),max:Number(a[1])})})}else"F"==e.charAt(0)&&(n.fileName=e.substr(1),angular.forEach(t,function(e,t){e.mainDnt&&0==e.mainDnt.indexOf(n.fileName+".")&&(n.itemSource=t)}))}),n},createGroupLink:function(e,t){var n=[],a=this;if(null==t)return"";angular.forEach(t.items,function(e,t){var i=a.encodeItem(e,!0);i&&i.length&&n.push(i)});var i="#/view-group/"+m.dntLocation.region+"/?";return t.enemyLevel&&(i+="&e="+t.enemyLevel),t.playerLevel&&(i+="&p="+t.playerLevel),t.heroLevel&&(i+="&h="+t.heroLevel),t.job&&t.job.id&&(i+="&j="+t.job.id),t.damageType&&t.damageType.id&&(i+="&d="+t.damageType.id),t.element&&t.element.id&&(i+="&t="+t.element.id),t.secondaryElement&&t.secondaryElement.id&&(i+="&s="+t.secondaryElement.id),i+="&g="+encodeURI(e)+"&i="+n.join(",")},createShortUrl:function(t,n){var a=this.createGroupLink(t,n),i=window.location.href.split("#")[0]+a,s={longUrl:i};e.post("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyD5t5o7ZcSAvM-xMwc14ft2BA-MKQA7LMo",s).success(function(e,t,i,s){n.shortUrl=e.id,sessionStorage.setItem(a,e.id)}).error(function(e,t,n,a){})},reloadItem:function(e){if(null!=e){if("itemTypeName"in e&&!e.itemSource&&(e.itemSource=e.itemTypeName),"rbTech"==e.itemSource&&(e.itemSource="tech"),"custom"==e.itemSource||"custom"==e.typeName)return e.typeName="custom",e;if("skills"==e.itemSource||"skills"==e.typeName){e.enchantmentNum||(e.enchantmentNum=1);var s="skilltable_character"+e.baseJobName+".lzjson",m="pve";"pvp"==e.pve&&(m="pvp");var u="skillleveltable_character"+e.baseJobName+m+".lzjson",c=n.find(s,"id",e.id)[0],d=n.getData(u),h={};angular.forEach(d,function(t,n){if(t.SkillIndex==e.id&&t.SkillLevel==e.enchantmentNum)return void(h=t)});var p={id:e.id,itemSource:e.itemSource,typeName:e.itemSource,needJobClass:c.NeedJob,baseJobName:e.baseJobName,rank:i.rankNames[0],enchantmentNum:e.enchantmentNum,name:r.translate(c.NameID,c.NameIDParam),description:r.translate(h.SkillExplanationID,h.SkillExplanationIDParam),icon:c.IconImageIndex,pve:e.pve};return p.stats=o.getSkillStats(p,c,d),p}if(e.itemSource in t){var f=t[e.itemSource],g=n.find(f.mainDnt,"id",e.id);if(g.length){var v=g[0],b=0,S=null,y=n.find(f.potentialDnt,"id",e.pid);if(y.length||(y=n.find(f.potentialDnt,"PotentialID",v.TypeParam1)),!y.length){var y=n.find(f.potentialDntEx,"id",e.pid);y.length||(y=n.find(f.potentialDntEx,"PotentialID",v.TypeParam1))}if(y.length>0)if(S=y[0],S.PotentialID!=v.TypeParam1)S=null,console.log("bad potential");else{var I=n.find(f.potentialDnt,"PotentialID",S.PotentialID);angular.forEach(I,function(e,t){b+=e.PotentialRatio})}var p=a.createItem(f.name,v,S,b);a.initItem(p),l.setItemCategory(p,v);var C=null;if(C="weapons"!=p.typeName&&0!=p.typeId?"partsDnt":"weaponDnt",C&&n.isLoaded(f[C])&&n.isLoaded(f.setDnt)){p.setStats=[];var N=n.find(f[C],"id",e.id);if(N.length>0){p.setId=N[0].SetItemID;var x=n.find(f.setDnt,"id",N[0].SetItemID);x.length>0&&(p.setStats=i.getStats(x[0]))}}if(p.fullStats=p.stats,e.enchantmentNum>=0)if(p.enchantmentNum=e.enchantmentNum,"skills"==p.typeName);else if("talisman"==p.typeName){var D=[];angular.forEach(p.stats,function(e,t){D.push({id:e.id,max:e.max*(p.enchantmentNum/100)})}),p.enchantmentStats=D,p.fullStats=i.mergeStats(p.enchantmentStats,p.stats)}else{var L=n.find(f.enchantDnt,"EnchantID",p.enchantmentId);angular.forEach(L,function(e,t){if(e.EnchantLevel==p.enchantmentNum)return p.enchantmentStats=i.getStats(e),void(p.fullStats=i.mergeStats(p.enchantmentStats,p.stats))})}if(e.sparkId>0){p.sparkId=e.sparkId;var k=n.find(f.sparkDnt,"id",e.sparkId);k.length>0&&(p.sparkStats=i.getStats(k[0]),p.fullStats=i.mergeStats(p.fullStats,p.sparkStats))}else if(v.dragonjeweltype){p.offensiveGemSlots=0,p.increasingGemSlots=0;var T=n.find("dragonjewelslottable.lzjson","DragonJewelID",v.dragonjeweltype);T&&T.length>0&&(1==T[0].DragonJewelSlot1&&p.offensiveGemSlots++,1==T[0].DragonJewelSlot2&&p.offensiveGemSlots++,1==T[0].DragonJewelSlot3&&p.offensiveGemSlots++,1==T[0].DragonJewelSlot4&&p.offensiveGemSlots++,2==T[0].DragonJewelSlot1&&p.increasingGemSlots++,2==T[0].DragonJewelSlot2&&p.increasingGemSlots++,2==T[0].DragonJewelSlot3&&p.increasingGemSlots++,2==T[0].DragonJewelSlot4&&p.increasingGemSlots++)}return p}console.log("item "+e.id+" not found in "+f.mainDnt)}if(e.fileName){var j=n.find(e.fileName+".lzjson","id",e.id);if(j.length>0){var v=j[0],p={id:e.id,data:v,levelLimit:v.LevelLimit,needJobClass:v.NeedJobClass,typeId:v.Type,exchangeType:v.ExchangeType,rank:i.rankNames[v.Rank],fileName:e.fileName,description:r.translate(v.DescriptionID,v.DescriptionIDParam)};return a.initItem(p),p}return{name:"unknown item"}}return{name:"unknown item source: "+e.itemSource}}},getDntFiles:function(e){var n={};if(null==e);else{if(!e.itemSource&&e.itemTypeName in t&&(e.itemSource=e.itemTypeName),"rbTech"==e.itemSource&&(e.itemSource="tech"),e.itemSource in t){var a=t[e.itemSource];n["exchange.lzjson"]=null,n["dragonjewelslottable.lzjson"]=null,n[a.mainDnt]=s.mainDnt,"potentialDnt"in a&&(n[a.potentialDnt]=s.potentialDnt),"potentialDntEx"in a&&(n[a.potentialDntEx]=s.potentialDnt),"enchantDnt"in a&&(n[a.enchantDnt]=s.enchantDnt),"weaponDnt"in a&&(n[a.weaponDnt]=s.weaponDnt),"partsDnt"in a&&(n[a.partsDnt]=s.partsDnt),"setDnt"in a&&(n[a.setDnt]=s.setDnt),"gemDnt"in a&&(n[a.gemDnt]=s.gemDnt),"sparkDnt"in a&&(n[a.sparkDnt]=s.sparkDnt)}else if("skills"==e.itemSource||"skills"==e.typeName){var i="skilltable_character"+e.baseJobName+".lzjson";n[i]=null;var o="skillleveltable_character"+e.baseJobName+"pve.lzjson";n[o]=null,o="skillleveltable_character"+e.baseJobName+"pvp.lzjson",n[o]=null}else"custom"==e.typeName;e.fileName&&(n[e.fileName+".lzjson"]=null)}return n}}}angular.module("dnsim").factory("exportLinkHelper",["$http","items","dntData","itemFactory","hCodeValues","itemColumnsToLoad","statHelper","translations","itemCategory","region",e])}(),function(){"use strict";function e(e){return{reloadGroup:function(t,n){var a=[];return angular.forEach(n.items,function(t,n){var i=e.reloadItem(t);i&&a.push(i)}),a},getDntFiles:function(t){var n={};return angular.forEach(t.items,function(t,a){var i=e.getDntFiles(t);angular.forEach(i,function(e,t){n[t]=e})}),n}}}angular.module("dnsim").factory("groupHelper",["exportLinkHelper",e])}(),function(){"use strict";function e(e,t,n){return{categories:[{path:"search/titles",name:"titles",sourceType:"titles",hideRank:!0,hideJob:!0,hideLevel:!0,numItemText:"1",maxCat:1},{path:"search/weapons",name:"weapons",sourceType:"equipment",numItemText:"2",maxExchange:1,maxCat:2,limitExchange:[1,2]},{path:"search/armour",name:"armour",sourceType:"equipment",numItemText:"5",maxExchange:1,maxCat:5,limitExchange:[3,4,5,6,7]},{path:"search/accessories",name:"accessories",sourceType:"equipment",hideJob:!0,maxCat:4,maxExchange:2,limitExchange:[8,9,10]},{path:"search/techs",name:"techs",sourceType:"techs",maxCat:4,maxExchange:2,limitExchange:[8,9,10]},{path:"search/offensive-gems",name:"offensive gems",sourceType:"gems",hideJob:!0,maxCat:4,maxExchange:4,limitExchange:[54]},{path:"search/increasing-gems",name:"increasing gems",sourceType:"gems",hideJob:!0,maxCat:14,maxExchange:14,limitExchange:[54]},{path:"search/enhancement-plates",name:"enhancement plates",sourceType:"plates",hideJob:!0,numItemText:"8+3",maxCat:11,maxExchange:15,limitExchange:[33]},{path:"search/expedition-plates",name:"expedition plates",sourceType:"plates",hideRank:!0,hideJob:!0,numItemText:"4",maxCat:4,maxExchange:15,limitExchange:[33]},{path:"search/talisman",name:"talisman",sourceType:"talisman",hideJob:!0,numItemText:"8+4",maxCat:12,maxExchange:12,limitExchange:[52,53]},{path:"search/costume",name:"costume",sourceType:"cash",numItemText:"7",maxCat:7,maxExchange:1,hideLevel:!0,limitExchange:[16,17,18,19,20,21,22]},{path:"search/cash",name:"cash",sourceType:"cash",numItemText:"8",maxCat:8,maxExchange:2,hideJob:!0,hideLevel:!0,limitExchange:[23,24,25,26,27,28,29]},{path:"search/extras",name:"extras",sourceType:"xtras",limitExchange:[47],hideJob:!0,hideLevel:!0},{path:"search/skills",name:"skills",searchType:"skills"},{path:"search/custom",name:"custom",searchType:"custom"}],byName:function(e){var t=null;return angular.forEach(this.categories,function(n,a){n.name==e&&(t=n)}),t},byPath:function(e){var t=null;return angular.forEach(this.categories,function(n,a){n.path==e&&(t=n)}),t},getItems:function(n){var a=this.byName(n);if(a&&"sourceType"in a){var i=[];angular.forEach(t,function(t,n){t.type==a.sourceType&&i&&(t.items||t.loading||e.loadItems(t),i=t.items?i.concat(t.items):null)});var s=[];if(i){var o=this;angular.forEach(i,function(e,t){(e.typeName==a.name||o.isItemForCat(a,e,e.data))&&(e.typeName=n,s.push(e))})}return s}return null},isItemForCat:function(e,a,i){if(a.itemSource in t&&t[a.itemSource].type!=e.sourceType)return!1;if(a.itemType==e.name)return!0;if(e.limitExchange){for(var s=0;s<e.limitExchange.length;++s)if(e.limitExchange[s]==a.exchangeType||i&&e.limitExchange[s]==i.ExchangeType){if("plate"==a.itemSource)return a.rawData&&4==i.Rank||a.rank&&4==a.rank.id?"expedition plates"==e.name:"enhancement plates"==e.name;if("gem"==a.itemSource){var o=n.find(t.gem.gemDnt,"id",a.id);if(o.length>0)return 1==o[0].Type?"offensive gems"==e.name:2==o[0].Type&&"increasing gems"==e.name}return!0}}else if(a.itemSource in t)return t[a.itemSource].type==e.sourceType;return!1},init:function(e,n){var a=this.byName(e);a&&"sourceType"in a&&angular.forEach(t,function(e,t){e.type==a.sourceType&&e.init(function(){},n)})},setItemCategory:function(e,t){var n=this;angular.forEach(this.categories,function(a,i){n.isItemForCat(a,e,t)&&(e.typeName=a.name)})},getItemsByCategory:function(e){var t={};if(e){var n={};angular.forEach(e,function(e,t){e&&(e.typeName in n||(n[e.typeName]=[]),n[e.typeName].push(e))}),angular.forEach(this.categories,function(e,a){if(e.name in n){var i=n[e.name].sort(function(t,n){if("talisman"==e.name){var a=t.enchantmentNum;a||(a=0);var i=n.enchantmentNum;if(i||(a=0),a!=i)return i-a}else{if("gem"==t.itemSource||"plate"==t.itemSource)return n.levelLimit-t.levelLimit;if("exchangeType"in t&&"exchangeType"in n)return t.exchangeType-n.exchangeType}return t.name.localeCompare(n.name)});t[e.name]=i}else t[e.name]=[]}),angular.forEach(e,function(e,n){!e||e.typeName in t||(t.typeError=!0)})}return t}}}angular.module("dnsim").factory("itemCategory",["itemFactory","items","dntData",e])}(),function(){"use strict";function e(e,t,n,a){function i(e,t,a,i){return{data:t,potential:a,id:t.id,totalRatio:i,itemSource:e,levelLimit:t.LevelLimit,needJobClass:t.NeedJobClass,typeId:t.Type,exchangeType:t.ExchangeType,rank:n.rankNames[t.Rank],pid:null,name:null,stats:null,potentialRatio:null,typeName:null,sparkId:null}}function s(n){if(!t.isLoaded(n.mainDnt))return null;if(!e.isLoaded())return null;if("potentialDnt"in n&&!t.isLoaded(n.potentialDnt))return null;if("potentialDntEx"in n&&!t.isLoaded(n.potentialDntEx))return null;var a=(new Date).getTime();n.items=[];for(var s=t.getNumRows(n.mainDnt),r=0;r<s;++r){var l=t.getValue(n.mainDnt,r,"Type"),m=t.getValue(n.mainDnt,r,"LevelLimit"),u=t.getValue(n.mainDnt,r,"Rank");if(8!=l&&29!=l&&114!=l&&79!=l&&174!=l&&130!=l&&24!=l&&182!=l&&78!=l&&20!=l&&46!=l&&9!=l&&(!n.minLevel||m>=n.minLevel)&&(!n.maxLevel||m<=n.maxLevel)&&(!n.minRank||u>=n.minRank)){var c=t.getValue(n.mainDnt,r,"State1_GenProb"),d=t.getValue(n.mainDnt,r,"StateValue1"),h=t.getValue(n.mainDnt,r,"TypeParam1");if(c>0||d>0||h>0){var p=t.getRow(n.mainDnt,r);if("techs"==n.type){for(var f=!1,g=0;g<n.items.length;++g)if(n.items[g].needJobClass==p.NeedJobClass&&n.items[g].levelLimit==p.LevelLimit&&n.items[g].potential&&n.items[g].potential.PotentialID==h){f=!0;break}if(f)continue}var v=[];h>0&&"potentialDnt"in n&&(v=t.find(n.potentialDnt,"PotentialID",h),!v.length&&"potentialDntEx"in n&&(v=t.find(n.potentialDntEx,"PotentialID",h)));var b=v.length;if(b){for(var S=0,y=0;y<b;++y)S+=v[y].PotentialRatio;for(var y=0;y<b;++y){for(var I=!1,C=0;C<y;++C)if(o(v[y],v[C])){I=!0;break}if(!I){for(var C=y+1;C<b;++C)o(v[y],v[C])&&(v[y].PotentialRatio+=v[C].PotentialRatio);n.items.push(i(n.name,p,v[y],S))}}}else n.items.push(i(n.name,p,null,0))}}}var N=(new Date).getTime(),x=N-a;console.log("item init time: "+x/1e3+"s for "+n.name)}function o(e,t){for(var n=1,a=1;;){var i="State"+n,s="State"+a;if(107==e[i]&&(n++,i="State"+n),107==t[s]&&(a++,s="State"+a),!(i in e||s in t))return!0;if(!(i in e))return!1;if(!(s in t))return!1;if(e[i]==-1&&t[s]==-1)return!0;if(!(e[i]>=0||t[s]>=0))return!0;if(e[i]!=t[s])return!1;var o="State"+n+"Value",r="State"+a+"Value";if(e[o]!=t[r])return!1;++n}}function r(t){if(t.data){var a=t.data,i=t.potential;if(null==t.name&&(t.name=e.translate(a.NameID,a.NameIDParam)),!t.sparkTypeId&&a.TypeParam2>0&&(t.sparkTypeId=a.TypeParam2),null==t.stats){var s=n.getStats(a);if(i){var o=n.getStats(i);s=n.mergeStats(s,o)}t.stats=s}a.SkillID&&!t.skillId&&(t.skillId=a.SkillID),null==t.iconIndex&&(t.icon=a.IconImageIndex,t.icon||"title"!=t.itemSource||(t.icon=12417)),a.EnchantID&&!t.enchantmentId&&(t.enchantmentId=a.EnchantID),i&&(t.pid=i.id,null===t.potentialRatio&&(t.potentialRatio=l(i,t.totalRatio))),delete t.data,delete t.potential}}function l(e,t){if(e&&e.PotentialRatio>0&&0!=t){var n=Math.round(e.PotentialRatio/t*100*100)/100;if(100!=n)return n+"%"}return null}function m(e){var n=null,i=a[e.itemSource];if(e.fileName&&t.isLoaded(e.fileName+".optimised.lzjson")?n=e.fileName+".optimised.lzjson":e.fileName&&t.isLoaded(e.fileName+".lzjson")?n=e.fileName+".lzjson":i&&t.isLoaded(i.mainDnt)&&(n=i.mainDnt),n){var s=t.find(n,"id",e.id);if(s&&s.length>0)return s[0]}return[]}function u(t){return t?{id:t.id,name:e.translate(t.NameID,t.NameIDParam),rank:n.rankNames[t.Rank],icon:t.IconImageIndex,levelLimit:t.LevelLimit,fileName:t.fileName}:[]}return{loadItems:s,initItem:r,createItem:i,getItemData:m,createBasicItem:u}}angular.module("dnsim").factory("itemFactory",["translations","dntData","hCodeValues","items",e])}(),function(){"use strict";function e(e,t,n){function a(a,s){var o=this;o.loading=!0,o.items?s():(e.init(a,function(){i(o,s)}),t.init(o.mainDnt,n.mainDnt,a,function(){i(o,s)}),"potentialDnt"in o&&t.init(o.potentialDnt,n.potentialDnt,a,function(){i(o,s)}),"potentialDntEx"in o&&t.init(o.potentialDntEx,n.potentialDnt,a,function(){i(o,s)}),"gemDnt"in o&&t.init(o.gemDnt,n.gemDnt,a,function(){i(o,s)}),i(o,s))}function i(n,a){!e.isLoaded()||!t.isLoaded(n.mainDnt)||"potentialDnt"in n&&!t.isLoaded(n.potentialDnt)||"potentialDntEx"in n&&!t.isLoaded(n.potentialDntEx)||"gemDnt"in n&&!t.isLoaded(n.gemDnt)||(a(),n.loading=!1)}var s={title:{mainDnt:"appellationtable.optimised.lzjson",type:"titles",minLevel:0,minRank:0},tech:{mainDnt:"itemtable_skilllevelup.optimised.lzjson",potentialDnt:"potentialtable.optimised.lzjson",potentialDntEx:"potentialtable_reboot.optimised.lzjson",sparkDnt:"potentialtable_potentialjewel.optimised.lzjson",type:"techs",minLevel:24,minRank:0},tman:{mainDnt:"itemtable_talisman.optimised.lzjson",type:"talisman",potentialDnt:"potentialtable_talismanitem.optimised.lzjson",minLevel:24,minRank:0},gem:{mainDnt:"itemtable_dragonjewel.optimised.lzjson",potentialDnt:"potentialtable_dragonjewel.optimised.lzjson",potentialDntEx:"potentialtable_reboot.optimised.lzjson",enchantDnt:"enchanttable_dragonjewel.optimised.lzjson",gemDnt:"dragonjeweltable.optimised.lzjson",type:"gems",minLevel:24,minRank:3},plate:{mainDnt:"itemtable_glyph.optimised.lzjson",potentialDnt:"potentialtable_glyph.optimised.lzjson",type:"plates",minLevel:16,minRank:2},items:{mainDnt:"itemtable.optimised.lzjson",partsDnt:"partstable.optimised.lzjson",weaponDnt:"weapontable.optimised.lzjson",enchantDnt:"enchanttable.optimised.lzjson",potentialDnt:"potentialtable.optimised.lzjson",
setDnt:"setitemtable.optimised.lzjson",type:"equipment",minLevel:80,minRank:3},eq:{mainDnt:"itemtable_equipment.optimised.lzjson",partsDnt:"partstable_equipment.optimised.lzjson",weaponDnt:"weapontable_equipment.optimised.lzjson",enchantDnt:"enchanttable.optimised.lzjson",potentialDnt:"potentialtable.optimised.lzjson",sparkDnt:"potentialtable_potentialjewel.optimised.lzjson",setDnt:"setitemtable.optimised.lzjson",type:"equipment",minLevel:24,minRank:3},rbeq:{mainDnt:"itemtable_reboot.optimised.lzjson",partsDnt:"partstable_reboot.optimised.lzjson",weaponDnt:"weapontable_reboot.optimised.lzjson",enchantDnt:"enchanttable_reboot.optimised.lzjson",potentialDnt:"potentialtable_reboot.optimised.lzjson",setDnt:"setitemtable.optimised.lzjson",type:"equipment",minLevel:24,minRank:3},pvpeq:{mainDnt:"itemtable_pvp.optimised.lzjson",partsDnt:"partstable_pvp.optimised.lzjson",weaponDnt:"weapontable_pvp.optimised.lzjson",enchantDnt:"enchanttable.optimised.lzjson",setDnt:"setitemtable.optimised.lzjson",type:"equipment",minLevel:24,minRank:3},c2016:{mainDnt:"itemtable_common2016.optimised.lzjson",partsDnt:"partstable_common2016.optimised.lzjson",weaponDnt:"weapontable_common2016.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"cash",minLevel:0,minRank:0},c2015:{mainDnt:"itemtable_common2015.optimised.lzjson",partsDnt:"partstable_common2015.optimised.lzjson",weaponDnt:"weapontable_common2015.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"cash",minLevel:0,minRank:0},c2014:{mainDnt:"itemtable_common2014.optimised.lzjson",partsDnt:"partstable_common2014.optimised.lzjson",weaponDnt:"weapontable_common2014.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"cash",minLevel:0,minRank:0},cash:{mainDnt:"itemtable_cash.optimised.lzjson",partsDnt:"partstable_cash.optimised.lzjson",weaponDnt:"weapontable_cash.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"cash",minLevel:0,minRank:0},event:{mainDnt:"itemtable_event.optimised.lzjson",partsDnt:"partstable_event.optimised.lzjson",weaponDnt:"weapontable_event.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"cash",minLevel:0,minRank:0},xtras:{mainDnt:"itemtable_vehicle.optimised.lzjson",partsDnt:"vehiclepartstable.optimised.lzjson",setDnt:"setitemtable_cash.optimised.lzjson",type:"xtras",minLevel:0,minRank:0}};return angular.forEach(s,function(e,t){e.name=t,e.loading=!1,e.items=null,e.init=a,e.reset=function(){e.items=null,e.loading=!1}}),s}angular.module("dnsim").factory("items",["translations","dntData","itemColumnsToLoad",e])}(),function(){"use strict";function e(e,t,n){var a="jobtable.lzjson",i=n.jobsDnt;return{fileName:a,allJobs:null,isLoaded:function(){return e.isLoaded(a)},hasStartedLoading:function(){return e.hasStartedLoading(a)},init:function(t,n){e.init(a,i,t,function(){n()})},reset:function(){this.allJobs=null,e.reset(a)},getFinalJobs:function(){var e=[],t=this.getAllJobs();if(t)for(var n=t.length,a=0;a<n;++a)2==t[a].d.JobNumber&&t[a].d.JobIcon>0&&e.push(t[a]);return e},getBaseJobs:function(){var e=[],t={},n=this;return angular.forEach(this.getFinalJobs(),function(e,a){t[n.getBaseJobName(e)]=e}),angular.forEach(t,function(t,n){e.push(n)}),e},getAllJobs:function(){if(null==this.allJobs&&this.isLoaded()&&t.isLoaded()){for(var n=[],i=e.getData(a),s=i.length,o=0;o<s;++o)n[n.length]=this.createJob(i[o]);this.allJobs=n}return this.allJobs},getById:function(e){for(var t=this.getAllJobs(),n=t.length,a=0;a<n;++a)if(t[a].id==e)return t[a]},createJob:function(e){var n=this;return{d:e,id:e.id,name:t.translate(e.JobName),isClassJob:function(t){return n.isClassJob(e,t)}}},isClassJob:function(e,t){if(0==t)return!0;if(e.id==t)return!0;var n=e.ParentJob;if(!n)return!1;if(n==t)return!0;var a=this.getById(n);return!!a&&this.isClassJob(a.d,t)},getBaseJobName:function(e){if(this.isLoaded()){var t=this.getAllJobs();if(t)for(var n=t.length,a=0;a<n;++a)if(t[a].id==e.d.BaseClass+1&&t[a].d.EnglishName)return t[a].d.EnglishName}return null}}}angular.module("dnsim").factory("jobs",["dntData","translations","itemColumnsToLoad",e])}(),function(){"use strict";function e(e,t,n){function a(){console.log("init"),firebase.initializeApp({apiKey:"AIzaSyC-Mckgho1xAI2SQzsKnpsr2ObDKOhdSrE",authDomain:"dngearsim.firebaseapp.com",databaseURL:"https://dngearsim.firebaseio.com",storageBucket:"dngearsim.appspot.com"})}function i(){return t(function(t,n){var a=firebase.auth();a.onAuthStateChanged(function(n){null==n?(console.log("redirecting"),e.location.href="login.html"):(console.log("logged in"),t(n))})})}function s(e){return console.log("get profile"),t(function(t,n){firebase.database().ref("profile/"+e).once("value",function(e){t(e?e.val():{})})})}function o(e,n){return console.log("get build"),t(function(t,a){firebase.database().ref("builds/"+e+"/"+n).once("value",function(e){t(e?c(e.val()):{})})})}function r(e){return t(function(t,n){var a=v.getUser();a&&(e=angular.copy(e),h(e,!0),firebase.database().ref("profile/"+a.uid).set(e).then(t))})}function l(e){return console.log("get builds"),t(function(t,n){console.log("getting builds"),firebase.database().ref("builds/"+e).once("value",function(e){if(e){var n={},a=e.val();for(var i in a)n[i]=c(a[i]);t(n)}else t({})})})}function m(e){return console.log("get class builds"),t(function(t,n){console.log("getting builds",e.id),firebase.database().ref("job-builds/"+e.id).once("value",function(e){console.log("ok"),t(e?e.val():{})})})}function u(e){e.items&&_.each(e.items,function(e){delete e.fullStats});var t=JSON.stringify(e);return LZString.compressToUTF16(t)}function c(e){var t=LZString.decompressFromUTF16(e),a=JSON.parse(t);return a.items&&_.each(a.items,function(e){e.fullStats=e.stats,e.enchantmentStats&&e.enchantmentStats.length&&(e.fullStats=n.mergeStats(e.enchantmentStats,e.fullStats)),e.sparkStats&&e.sparkStats.length&&(e.fullStats=n.mergeStats(e.sparkStats,e.fullStats))}),a}function d(e,n){var a=v.getUser(),i=[];if(a&&(n=angular.copy(n),h(n,!0),i.push(firebase.database().ref("builds/"+a.uid+"/"+e).set(u(n))),n.job&&n.job.id)){console.log("saving build");var s={};n.playerLevel&&(s.lev=n.playerLevel),n.region&&(s.region=n.region),n.guild&&(s.guild=n.guild),n.about&&(s.about=n.about),h(s,!0),i.push(firebase.database().ref("job-builds/"+n.job.id+"/"+a.uid+"/"+e).set(s))}return t.all(i)}function h(e,t){for(var n in e)void 0===e[n]?delete e[n]:t&&"object"==typeof e[n]&&h(e[n],t)}function p(){var e=firebase.auth();return t(function(t,n){e.signOut().then(function(){t()},function(e){n()})})}function f(e){var n=firebase.auth(),a=v.getUser();return t(function(i,s){var o=[firebase.database().ref("builds/"+a.uid).remove(),firebase.database().ref("profile/"+a.uid).remove(),firebase.database().ref("private/"+a.uid).remove()],r=[];for(var l in e)e[l].job&&r.push(e[l].job.id);r=_.uniq(r),_.each(r,function(e){o.push(firebase.database().ref("job-builds/"+e+"/"+a.uid).remove())}),t.all(o).then(function(){console.log("deleted data"),a["delete"]().then(function(){console.log("deleted user"),n.signOut().then(function(){console.log("signed out"),i()},function(e){s()})})})})}function g(e,n){var a=[],i=v.getUser();return i&&(a.push(firebase.database().ref("builds/"+i.uid+"/"+e).remove()),n.job&&a.push(firebase.database().ref("job-builds/"+n.job.id+"/"+i.uid).remove())),t.all(a)}console.log("setup online service");var v={login:i,getUser:function(){return firebase.auth().currentUser},signOut:p,deleteAccount:f,getUserBuilds:l,deleteBuild:g,saveBuild:d,getBuild:o,getClassBuilds:m,getProfile:s,saveProfile:r};return a(),v}angular.module("dnsim").factory("onlineService",["$window","$q","hCodeValues",e])}(),function(){"use strict";function e(e,t,n,a,i,s,o){function r(e){for(var t=null,n=0;n<e.length;++n)e[n].def.isItemStep&&(t=e[n].value);for(var n=0;n<e.length;++n)e[n].def.alterItem&&e[n].def.alterItem(e[n].value.id,t);return t}function l(e,t,n,o){o||(o=9999);for(var r=a.getItems(e.name),l=[],m=r.length,u=0;u<m;++u){var c=r[u];if(!(t.job.id>0&&c.needJobClass>0)||s.isClassJob(t.job.d,c.needJobClass)){i.initItem(c);for(var d=!0,h=0;h<n.length;++h)if(n[h].matchesItem&&!n[h].matchesItem(c)){d=!1;break}if(d&&l.push(c),l.length>=o)break}}return l=l.sort(function(e,t){return e.name.localeCompare(t.name)})}return{stepDefs:{exchangeStep:{name:"type",getOptions:function(n,a,i){for(var s=[],o=0;o<n.limitExchange.length;++o){var r=n.limitExchange[o],l=0;if(a.items)for(var m=0;m<a.items.length;++m)a.items[m].exchangeType==r&&l++;if(!(l>=n.maxExchange)){var u=e.find("exchange.lzjson","ExchangeType",r),c="";if(u&&u.length>0&&u[0].NameID>0)var c=t.translate(u[0].NameID).toLowerCase();s.push({id:r,name:c.toLowerCase()})}}return s},matchesItem:function(e,t){return t.exchangeType==e}},accExchangeStep:{name:"type",getOptions:function(n,a,i){for(var s=[],o=0;o<n.limitExchange.length;++o){for(var r=n.limitExchange[o],l=0,m=0;m<a.items.length;++m)a.items[m]&&a.items[m].exchangeType==r&&l++;if(10==r||25==r){if(l>=2)continue}else if(l>=1)continue;var u=e.find("exchange.lzjson","ExchangeType",r);if(u&&u.length>0&&u[0].NameID>0){var c=t.translate(u[0].NameID).toLowerCase();s.push({id:r,name:c.toLowerCase()})}}return s},matchesItem:function(e,t){return t.exchangeType==e}},sixtyLevelStep:{name:"level",getOptions:function(e,t,n){return[{id:93,name:"level 93"},{id:90,name:"level 90"},{id:80,name:"level 80"},{id:70,name:"level 70"},{id:60,name:"level 60"}]},matchesItem:function(e,t){return t.levelLimit==e}},allLevelStep:{name:"level",getOptions:function(e,t,n){return[{id:93,name:"level 93"},{id:90,name:"level 90"},{id:80,name:"level 80"},{id:70,name:"level 70"},{id:60,name:"level 60"},{id:50,name:"level 50"},{id:40,name:"level 40"},{id:32,name:"level 32"},{id:24,name:"level 24"}]},matchesItem:function(e,t){return t.levelLimit==e}},cashRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:4,name:"unique"},{id:3,name:"epic"},{id:2,name:"rare"},{id:1,name:"magic"},{id:0,name:"normal"}]},matchesItem:function(e,t){return t.rank.id==e}},techRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:4,name:"unique"},{id:3,name:"epic"}]},matchesItem:function(e,t){return t.rank.id==e}},talismanRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:2,name:"rare"},{id:999,name:"quality high grade"},{id:1,name:"magic"},{id:0,name:"normal"}]},matchesItem:function(e,t){if(i.initItem(t),t.name){var n=Math.max(t.name.indexOf("Quality"),t.name.indexOf("High Grade"));return 999==e?0===n:t.rank.id==e&&0!=n}return!1}},gemRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:5,name:"legendary"},{id:999,name:"quality high grade epic"},{id:3,name:"epic"}]},matchesItem:function(e,t){if(i.initItem(t),t.name){var n=Math.max(t.name.indexOf("Quality"),t.name.indexOf("High Grade"));return 999==e?3==t.rank.id&&n>=0:t.rank.id==e&&n<0}return!1}},otherRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:3,name:"epic"},{id:2,name:"rare"},{id:1,name:"normal"}]},matchesItem:function(e,t){return t.rank.id==e}},equipRankStep:{name:"rank",getOptions:function(e,t,n){return[{id:5,name:"legendary"},{id:4,name:"unique"},{id:3,name:"epic"}]},matchesItem:function(e,t){return t.rank.id==e}},enhanceTalismanStep:{name:"slot",getOptions:function(e,t,n){return[{id:100,name:"+100% slot"},{id:75,name:"+75% slot"},{id:25,name:"+25% slot"},{id:0,name:"+0% slot"}]},alterItem:function(e,t){t.enchantmentNum=e}},titleStep:{name:"select",getOptions:function(e,t,n){for(var a=l(e,t,n,9999),i=[],s=0;s<a.length;++s)switch(a[s].id){case 1975:case 1973:case 1008:case 230:case 279:case 1313:case 2032:i.push(a[s])}return i},hasOptions:function(e,t,n){return!0},isItemStep:!0},enhanceStep:{name:"enhance",getOptions:function(e,t,n){var a=r(n);return a&&a.enchantmentId?[{id:14,name:"enhance to +14"},{id:13,name:"enhance to +13"},{id:12,name:"enhance to +12"},{id:11,name:"enhance to +11"},{id:10,name:"enhance to +10"},{id:9,name:"enhance to +9"},{id:8,name:"enhance to +8"},{id:7,name:"enhance to +7"},{id:6,name:"enhance to +6"},{id:5,name:"enhance to +5"},{id:4,name:"enhance to +4"},{id:3,name:"enhance to +3"},{id:2,name:"enhance to +2"},{id:1,name:"enhance to +1"},{id:0,name:"not enhanced"}]:[{id:0,name:"not enhanced"}]},alterItem:function(e,t){t.enchantmentNum=e}},itemStep:{name:"select",getOptions:function(e,t,n){return l(e,t,n)},isItemStep:!0},techSkillStep:{name:"skill",getOptions:function(e,t,n){var a=l(e,t,n,1);return a.length>0?[{id:a[0].skillId,name:a[0].skillId}]:[]},matchesItem:function(e,t){return t.skillId==e}},itemNameStep:{name:"item",getOptions:function(e,t,n){for(var a=l(e,t,n),i={},s=[],o=0;o<a.length;++o){var r=a[o].name;r in i||(i[r]=!0,s.push({id:r,name:r}))}return s},matchesItem:function(e,t){return t.name==e},isItemStep:!0},distinctItemNameStep:{name:"item",getOptions:function(e,t,n){for(var a=l(e,t,n),i={},s=[],o=0;o<t.items.length;++o){var r=t.items[o];i[r.name]=!0}for(var o=0;o<a.length;++o){var m=a[o].name;m in i||(i[m]=!0,s.push({id:m,name:m}))}return s},matchesItem:function(e,t){return t.name==e},isItemStep:!0},numStatsStep:{name:"Num Stats",getOptions:function(e,t,n){for(var a=l(e,t,n),i={},s=0;s<a.length;++s){for(var r=0,m=0;m<a[s].stats.length;++m){var u=o.stats[a[s].stats[m].id];u&&!u.hide&&r++}i[r+"x stats"]=r}var c=[];for(var d in i)c.push({id:i[d],name:d});return c=c.sort(function(e,t){return e.id-t.id})},matchesItem:function(e,t){for(var n=0,a=0;a<t.stats.length;++a){var i=o.stats[t.stats[a].id];i&&!i.hide&&n++}return n==e},isItemStep:!0},customStep:{name:"misc",getOptions:function(e,t,n){return o.customItems},isItemStep:!0}},categorySteps:{titles:["titleStep"],weapons:["exchangeStep","sixtyLevelStep","equipRankStep","itemStep","enhanceStep"],armour:["exchangeStep","sixtyLevelStep","equipRankStep","itemStep","enhanceStep"],accessories:["accExchangeStep","allLevelStep","equipRankStep","itemNameStep","itemStep"],"offensive gems":["sixtyLevelStep","gemRankStep","itemNameStep","numStatsStep","itemStep","enhanceStep"],"increasing gems":["sixtyLevelStep","gemRankStep","itemNameStep","numStatsStep","itemStep","enhanceStep"],"enhancement plates":["allLevelStep","otherRankStep","distinctItemNameStep","numStatsStep","itemStep"],"unique plates":["sixtyLevelStep","distinctItemNameStep","numStatsStep","itemStep"],talisman:["sixtyLevelStep","talismanRankStep","distinctItemNameStep","numStatsStep","itemStep","enhanceTalismanStep"],costume:["exchangeStep","otherRankStep","itemNameStep","itemStep"],cash:["accExchangeStep","cashRankStep","itemNameStep","itemStep"],techs:["exchangeStep","allLevelStep","techRankStep","techSkillStep","itemStep"],custom:["customStep"]},getOptions:function(e,t,n){if(e.name in this.categorySteps){var a=this.getStepName(e,n.length);return this.stepDefs[a].getOptions(e,t,n)}return[]},hasOptions:function(e,t,n){if(e.name in this.categorySteps){var a=this.getStepName(e,n.length);return this.stepDefs[a].hasOptions?this.stepDefs[a].hasOptions(e,t,n):this.stepDefs[a].getOptions(e,t,n).length>0}return!1},isValidStepNumber:function(e,t){return this.categorySteps[e.name].length>t},createData:function(e,t,n){var a=this.getStepName(t,n),i=this.stepDefs[a];return{step:a,value:e,def:i,matchesItem:function(t){return i.matchesItem(e.id,t)}}},getItem:r,getStepName:function(e,t){return this.categorySteps[e.name][t]}}}angular.module("dnsim").factory("quickAdd",["dntData","translations","itemColumnsToLoad","itemCategory","itemFactory","jobs","hCodeValues",e])}(),function(){"use strict";function e(e,t,n,a){var i={region:"ALT",name:"Alternative user specified files",url:""},s=[{region:"na",name:"english files from nexon north america",url:"https://dnna.firebaseapp.com"},{region:"kdn",name:"korean files from pupu",url:"https://kdnfiles.firebaseapp.com"},{region:"cdn",name:"chinese files from shanda",url:"https://cdnfiles.firebaseapp.com"},{region:"sea",name:"south east asia - english files from cherry credits",url:"https://seadnfiles.firebaseapp.com"},{region:"eu",name:"europe - english files from cherry credits",url:"https://eufiles.firebaseapp.com"},{region:"ina",name:"indonesian files from gemscool",url:"https://inafiles-da491.firebaseapp.com"}],o=localStorage.getItem("lastDNTRegion"),r=s[0];o&&angular.forEach(s,function(e,t){e.region==o&&(r=e)});var l=localStorage.getItem("UIStrings_file"),m=null;return l&&angular.forEach(s,function(e,t){if(e.region!=i.region&&l.indexOf(e.url)>-1)return void(m=e)}),null==m&&(m=r),{hostedFiles:s,alternativeFiles:i,dntLocation:r,tlocation:m,setCustomUrl:function(e){this.alternativeFiles.url=e;var t=[];angular.forEach(s,function(e,n){e.region!=i.region&&t.push(e)}),t.push(i),s=t,this.hostedFiles=t},setLocationByName:function(e){var t=null;angular.forEach(s,function(n,a){n.region==e&&(t=n)}),this.setLocation(t)},setLocation:function(e){e&&e!=this.dntLocation&&(this.dntLocation=e,t(),localStorage.setItem("lastDNTRegion",e.region),t(),a.reload()),null==this.tlocation&&this.setTLocation(e),this.init()},setTLocation:function(n){n!=this.tlocation&&(angular.forEach(this.translationResettingEvents,function(e,t){e()}),this.tlocation=n,sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file"),t(),e.reset(),e.location=this.tlocation.url,e.init(function(){},function(){a.reload()}))},init:function(){this.tlocation&&(e.location=this.tlocation.url),n.setLocation(this.dntLocation)}}}angular.module("dnsim").factory("region",["translations","dntReset","dntData","$route",e])}(),function(){"use strict";function e(e){return{saveItem:function(e,t){var n=this.getSavedItems();e in n&&Array.isArray(n[e].items)?(n[e].items.push(t),n[e].lastUpdate=(new Date).getTime(),this.updatedSavedItems(e,n[e].items)):this.updatedSavedItems(e,[t]),localStorage.setItem("lastSavedGroup",e)},saveBuildSelection:function(e,t){this.setCurrentBuild(e),t&&e in t&&t[e].job&&t[e].job.id&&localStorage.setItem("jobNumber",t[e].job.id)},importGroup:function(e,t){var n=this.getSavedItems();return e=this.getUniqueGroupName(e,n),this.updatedSavedItems(e,t),e},getUniqueGroupName:function(e,t){var n=0;if(e.lastIndexOf(")")==e.length-1){var a=e.lastIndexOf("(");if(a>0){var i=Number(e.substr(a+1,e.length-a-2));i>0&&(n=i+1,e=e.substr(0,a-1))}}for(var s=e;;){var e=s;if(n>0&&(e=s+" ("+n+")"),!(e in t))break;n++}return e},updatedSavedItems:function(e,t){var n=this.getSavedItems();e in n?t.length?(n[e].items=t,n[e].lastUpdate=(new Date).getTime(),localStorage.setItem("lastSavedGroup",e)):(delete n[e],this.setCurrentBuild(null)):(n[e]={items:t,lastUpdate:(new Date).getTime()},localStorage.setItem("lastSavedGroup",e));var a=JSON.stringify(n);localStorage.setItem("savedItems",LZString.compressToUTF16(a))},renameSavedGroup:function(e,t,n,a,i,s,o,r,l,m,u,c,d,h){var p=this.getSavedItems();if(t in p||e==t)t=e;else if(e in p){var f=p[e];p[t]=f,delete p[e]}p[t].enemyLevel=n,p[t].playerLevel=a,p[t].heroLevel=i,p[t].job=s,p[t].damageType=o,p[t].element=r,p[t].secondaryElement=l,p[t].enemyStatCaps=m,p[t].playerStatCaps=u,p[t].conversions=c,p[t].baseStats=d,p[t].heroStats=h;var g=JSON.stringify(p);localStorage.setItem("savedItems",LZString.compressToUTF16(g))},getSavedItems:function(){try{var e=LZString.decompressFromUTF16(localStorage.getItem("savedItems")),t=JSON.parse(e);return t}catch(n){}return{}},getCustomItems:function(){try{var e=LZString.decompressFromUTF16(localStorage.getItem("customItems")),t=JSON.parse(e);return t}catch(n){}return[]},saveCustomItems:function(e){var t=JSON.stringify(e);localStorage.setItem("customItems",LZString.compressToUTF16(t))},getHiddenTypes:function(){try{var e=LZString.decompressFromUTF16(localStorage.getItem("hiddenTypes")),t=JSON.parse(e);return t}catch(n){}return{}},saveHiddenTypes:function(e){var t=JSON.stringify(e);localStorage.setItem("hiddenTypes",LZString.compressToUTF16(t))},currentBuild:null,getCurrentBuild:function(){if(!this.currentBuild&&(this.currentBuild=localStorage.getItem("currentGroup"),this.currentBuild)){var e=this.getSavedItems();this.currentBuild in e||(localStorage.removeItem("currentGroup"),this.currentBuild=null)}return this.currentBuild},setCurrentBuild:function(e){this.currentBuild=e,localStorage.setItem("currentGroup",e)}}}angular.module("dnsim").factory("saveHelper",["itemCategory",e])}(),function(){"use strict";function e(e){return{getSetStats:function(t){var n=[],a={};return angular.forEach(t,function(e,t){null!==e&&null!=e.setStats&&(e.setId in a?a[e.setId].numItems++:a[e.setId]={numItems:1,stats:e.setStats})}),angular.forEach(a,function(e,t){angular.forEach(e.stats,function(t,a){t.needSetNum<=e.numItems&&n.push(t)})}),e.mergeStats(n)},getCombinedStats:function(t){var n=[];return angular.forEach(t,function(e,t){e&&(e.fullStats?n=n.concat(e.fullStats):e.stats&&(n=n.concat(e.stats)))}),e.mergeStats(n)},getCalculatedStats:function(t,n){function a(t){var n=e.stats[t.id];return u[n.pc]?Number(u[n.pc].max):0}function i(t){var n=e.stats[t.id];return u[n.skPc]?Number(u[n.skPc].max):0}function s(e){e.max=Math.floor(e.max*(1+a(e))*(1+i(e)))}function o(e){var t=u[e];return t?{id:e,max:Number(t.max),pc:t.pc}:{id:e,max:0,pc:0}}function r(e){e.max>0&&m.push(e)}function l(n,a,i){var s=(a+i)/2;s+=_*(U+1)*s*.75,s*=1+$.max;var o=s;if(t.element&&t.element.id>0){var l=u[e.elements[t.element.id].dmgStat];l&&(o*=1+Number(l.max))}r({id:n,max:o});var m=0,c=0;if(c=t.element?t.element.id:0,m=t.secondaryElement?t.secondaryElement.id:0,m!=c)if(m>0){var d=u[e.elements[t.secondaryElement.id].dmgStat];if(d){var h=s*(1+Number(d.max));r({id:n+1e3,max:h})}}else r({id:n+1e3,max:s})}var m=[],u={};if(!t.conversions||!t.enemyStatCaps||!t.playerStatCaps)return[];angular.forEach(n,function(e,t){u[e.id]=e});var c=o(0);s(c),r(c);var d=o(1);s(d),r(d);var h=o(2);s(h),r(h);var p=o(3);s(p),r(p);var f=o(25);f.max+=p.max*Number(t.conversions.HP),s(f),r(f);var g=o(8);g.max+=p.max*Number(t.conversions.PhysicalDefense),s(g),r(g);var v=o(1008);v.max=Math.min(.85,g.max/Number(t.enemyStatCaps.Cdefense)),r(v);var b=o(9);b.max+=h.max*Number(t.conversions.MagicDefense),s(b),r(b);var S=o(1009);S.max=Math.min(.85,b.max/Number(t.enemyStatCaps.Cdefense)),r(S);var y=o(3e3);if(!t.damageType||2!=t.damageType.id){var I=o(32),C=o(101),N=o(3001),x=o(10164),D=o(4);D.max+=I.max,D.max+=Math.floor(c.max*Number(t.conversions.StrengthAttack)),D.max+=Math.floor(d.max*Number(t.conversions.AgilityAttack)),D.max=Math.floor(D.max*(1+(a(D)+C.max))),D.max=Math.floor(D.max*(1+y.max+N.max)),D.max+=Math.floor(x.max*h.max),r(D);var L=o(5);L.max+=I.max,L.max+=Math.floor(c.max*Number(t.conversions.StrengthAttack)),L.max+=Math.floor(d.max*Number(t.conversions.AgilityAttack)),L.max=Math.floor(L.max*(1+(a(L)+C.max))),L.max=Math.floor(L.max*(1+y.max+N.max)),L.max+=Math.floor(x.max*h.max),r(L)}if(!t.damageType||1!=t.damageType.id){var k=o(33),T=o(102),j=o(3002),E=o(10165),w=o(6);w.max+=k.max,w.max+=Math.floor(h.max*Number(t.conversions.IntelligenceAttack)),w.max=Math.floor(w.max*(1+(a(w)+T.max))),w.max=w.max*(1+y.max+j.max),w.max+=Math.floor(E.max*c.max),r(w);var A=o(7);A.max+=k.max,A.max+=h.max*Number(t.conversions.IntelligenceAttack),A.max=Math.floor(A.max*(1+(a(A)+T.max))),A.max=A.max*(1+y.max+j.max),A.max+=Math.floor(E.max*c.max),r(A)}var z=o(12);z.max+=d.max*Number(t.conversions.Critical),s(z);var R=o(4012);z.max+=R.max,r(z);var P=o(1012),_=Math.min(.89,z.max/Number(t.enemyStatCaps.Ccritical)+P.max);m.push({id:1012,max:_});var B=o(103);B.max+=(c.max+h.max)*Number(t.conversions.StrengthIntelligenceToCriticalDamage),s(B),r(B);var U=B.max/t.playerStatCaps.CcriticalDamage;r({id:1103,max:U+2});var V=o(29);r(V);var J=Number(t.enemyStatCaps.Cfinaldamage),$=o(1029);$.max=Math.min(Math.max(.35*Number(V.max)/J,Math.pow(Number(V.max)/J,2.2)),1),r($);var O=o(16);r(O);var G=o(17);r(G);var M=o(18);r(M);var F=o(19);r(F),t.damageType&&1!=t.damageType.id&&0!=t.damageType.id||l(1004,D.max,L.max),t.damageType&&2!=t.damageType.id&&0!=t.damageType.id||l(1006,w.max,A.max),t.damageType&&3!=t.damageType.id||l(1001,w.max+D.max,A.max+L.max);var H=o(2008);H.max=f.max/(1-v.max);var q=o(2009);q.max=f.max/(1-S.max);var W=o(3008);return W.max=(H.max+q.max)/2,r(W),m},getNakedStats:function(e){return e.baseStats&&e.baseStats.Strength>0?[{id:0,max:e.baseStats.Strength},{id:1,max:e.baseStats.Agility},{id:2,max:e.baseStats.Intelligence},{id:3,max:e.baseStats.Stamina}]:[]},getSkillStats:function(t,n,a){var i=null;if(angular.forEach(a,function(e,n){if(e.SkillIndex==t.id&&e.SkillLevel==t.enchantmentNum)return void(i=e)}),!i)return null;for(var s=1,o=[],r=!0;r;){var l="EffectClass"+s,m="EffectClassValue"+s;if(n&&l in n&&m in i){if(n[l]>0){var u=i[m],c=n[l],d=e.skillEffectMapping[c];if(d&&d.getVals)for(var h=d.getVals(u),p=0;p<h.length;++p)o.push(h[p]);else{var f;if(f=d&&d.mapTo?d.mapTo:1e4+c,u>0)o.push({id:f,effect:c,max:u});else if(u.toString().indexOf(";")>0){var h=u.split(";");h.length>0&&h[0]>0&&o.push({id:f,effect:c,max:h[0]})}}}}else r=!1;s++}return o},getBuildStats:function(t){var n={};return n.nakedStats=this.getNakedStats(t),n.combinedStats=this.getCombinedStats(t.items),n.setStats=this.getSetStats(t.items),n.allStats=n.nakedStats.concat(n.combinedStats).concat(n.setStats),t.heroStats&&t.heroStats.length&&(n.heroStats=t.heroStats,n.allStats=n.allStats.concat(t.heroStats)),n.allStats=e.mergeStats(n.allStats),n.calculatedStats=this.getCalculatedStats(t,n.allStats),n}}}angular.module("dnsim").factory("statHelper",["hCodeValues",e])}(),function(){"use strict";function e(e,t){var n=new DnTranslations,a="uistring.optimised.lzjson",i=[],s=[];return{reset:function(){n=new DnTranslations,n.sizeLimit=100,this.loaded=!1,this.startedLoading=!1,i=[],s=[]},loaded:!1,startedLoading:!1,location:null,init:function(e,o){if(this.isLoaded())o();else if(s=[],s.push(e),i.push(o),!this.startedLoading){this.startedLoading=!0;var r=this,l=null;this.location&&""!=this.location&&(l=this.location+"/"+a,l!=localStorage.getItem("UIStrings_file")&&(sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file"))),t.$broadcast("TRANSLATION_LOAD_EVENT"),n.loadDefaultFile(l,function(e){angular.forEach(s,function(t,n){t(e)})},function(){r.loaded=!0,angular.forEach(i,function(e,t){e()}),i=[],t.$broadcast("TRANSLATION_LOAD_EVENT")},function(e){angular.forEach(s,function(t,n){t(e)}),t.$broadcast("TRANSLATION_LOAD_ERROR"),r.startedLoading=!1,r.loaded=!1})}},isLoaded:function(){if(!this.loaded){var e=this.location+"/"+a;e!=localStorage.getItem("UIStrings_file")&&(sessionStorage.removeItem("UIStrings"),localStorage.removeItem("UIStrings_file")),this.loaded=n.loadFromSession(),this.loaded&&(this.startedLoading=!0)}return this.loaded},translate:function(e,t){if(this.loaded){var a;if(!e)return"";if(a=n.translate(e),"string"!=typeof a)return"m"+a;if(t)for(var i=t.split(","),s=0;s<i.length;++s){var o=i[s];0==o.indexOf("{")&&(o=i[s].replace(/\{|\}/g,""),o=n.translate(o)),a=a.replace("{"+s+"}",o)}return a}return"m"+e}}}angular.module("dnsim").factory("translations",["$routeParams","$rootScope",e])}(),function(){"use strict";function e(){function e(e){return Math.floor(e.max)}function t(e){var t=Number(e.max);return t<100?t:t<1e5?Math.round(t/100)/10+"k":t<1e6?Math.round(t/1e3)+"k":t<1e7?Math.round(t/1e4)/100+"m":Math.round(t/1e6)+"m"}function n(e){return Math.floor(1e5*e.max)/1e3+"%"}return{stats:{0:{id:0,name:"str",display:e,dps:!0,pc:50,skPc:4050,searchable:!0},1:{id:1,name:"agi",display:e,dps:!0,pc:51,skPc:4051,searchable:!0},2:{id:2,name:"int",display:e,dps:!0,pc:52,skPc:4052,searchable:!0},3:{id:3,name:"vit",display:e,def:!0,pc:53,skPc:4053,searchable:!0},4:{id:4,name:"pdmg",display:e,combineWith:5,dps:!0,pc:54,searchable:!0},5:{id:5,name:"maxPdmg",display:e,hide:!0,pc:55},6:{id:6,name:"mdmg",display:e,combineWith:7,dps:!0,pc:56,searchable:!0},7:{id:7,name:"maxMdmg",display:e,hide:!0,pc:57},8:{id:8,name:"pdef",display:t,def:!0,pc:58,searchable:!0},9:{id:9,name:"mdef",display:t,def:!0,pc:59,searchable:!0},10:{id:10,name:"para",display:t,pc:60,noCustom:!0},11:{id:11,name:"para resist",display:t,pc:61,noCustom:!0},12:{id:12,name:"crit",display:e,dps:!0,pc:62,searchable:!0},13:{id:13,name:"crit resist",display:t,pc:63,noCustom:!0},14:{id:14,name:"stun",display:t,pc:64,noCustom:!0},15:{id:15,name:"stun resist",display:t,pc:65,noCustom:!0},16:{id:16,name:"fire%",display:n,dps:!0,searchable:!0},17:{id:17,name:"ice%",display:n,dps:!0,searchable:!0},18:{id:18,name:"light%",display:n,dps:!0,searchable:!0},19:{id:19,name:"dark%",display:n,dps:!0,searchable:!0},20:{id:20,name:"fire def",display:n,def:!0,searchable:!0},21:{id:21,name:"ice def",display:n,def:!0,searchable:!0},22:{id:22,name:"light def",display:n,def:!0,searchable:!0},23:{id:23,name:"dark def",display:n,def:!0,searchable:!0},25:{id:25,name:"hp",display:t,def:!0,pc:75,skPc:4075,searchable:!0},26:{id:26,name:"mp",display:t,def:!0,pc:76,skPc:4076},29:{id:29,name:"fd",display:e,dps:!0,searchable:!0},32:{id:32,name:"pdmg",display:e,dps:!0,pc:54},33:{id:33,name:"mdmg",display:e,dps:!0,pc:56},50:{id:50,name:"str%",display:n,dps:!0},51:{id:51,name:"agi%",display:n,dps:!0},52:{id:52,name:"int%",display:n,dps:!0},53:{id:53,name:"vit%",display:n,def:!0},54:{id:54,name:"pdmg%",display:n,combineWith:55,dps:!0},55:{id:55,name:"maxPdmg%",display:n,hide:!0},56:{id:56,name:"mdmg%",display:n,combineWith:57,dps:!0},57:{id:57,name:"maxMdmg%",display:n,hide:!0},58:{id:58,name:"pdef%",display:n,def:!0},59:{id:59,name:"mdef%",display:n,def:!0},60:{id:60,name:"para%",display:n,noCustom:!0,def:!0},61:{id:61,name:"para resist%",display:n,noCustom:!0,def:!0},62:{id:62,name:"crit%",display:n,dps:!0},63:{id:63,name:"crit resist%",display:n,def:!0},64:{id:64,name:"stun%",display:n,noCustom:!0,def:!0},65:{id:65,name:"stun resist%",display:n,noCustom:!0,def:!0},74:{id:74,name:"move%",display:n,noCustom:!0,def:!0},75:{id:75,name:"hp%",display:n,def:!0},76:{id:76,name:"mp%",display:n,def:!0},77:{id:77,name:"mp recover%",display:n,def:!0},81:{id:81,name:"safe move%",display:n,noCustom:!0,def:!0},101:{id:101,name:"pdmg%",display:n,noCustom:!0,dps:!0},102:{id:102,name:"mdmg%",display:n,noCustom:!0,dps:!0},103:{id:103,name:"crit dmg",display:e,dps:!0,pc:104},104:{id:104,name:"crit dmg%",display:n,noCustom:!0,dps:!0},105:{id:104,name:"pvp dmg",display:t,noCustom:!0,dps:!0},106:{id:106,name:"pvp def",display:t,noCustom:!0,def:!0},107:{id:107,name:"mp?",display:e,noCustom:!0,hide:!0,def:!0},1001:{id:1001,name:"dmg",display:t,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1004:{id:1004,name:"pdmg",display:t,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1006:{id:1006,name:"mdmg",display:t,summaryDisplay:!0,element:"primary",noCustom:!0,hide:!0},1008:{id:1008,name:"pdef",display:n,noCustom:!0},1009:{id:1009,name:"mdef",display:n,noCustom:!0},1012:{id:1012,name:"crit chance",display:n,noCustom:!0},1029:{id:1029,name:"fd",display:n,noCustom:!0},1103:{id:1103,name:"crit dmg",display:n,noCustom:!0},2001:{id:2001,name:"dmg",display:t,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2004:{id:2004,name:"pdmg",display:t,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2006:{id:2006,name:"mdmg",display:t,summaryDisplay:!0,element:"secondary",noCustom:!0,hide:!0},2008:{id:2008,name:"pdef eqhp",display:t,noCustom:!0},2009:{id:2009,name:"mdef eqhp",display:t,noCustom:!0},3e3:{id:3e3,name:"skDmg%",display:n,dps:!0},3001:{id:3001,name:"skPDmg%",display:n,dps:!0},3002:{id:3002,name:"skMDmg%",display:n,dps:!0},3008:{id:3008,name:"eqhp",display:t,summaryDisplay:!0,noCustom:!0,hide:!0},4012:{id:4012,name:"skCrit",display:t,dps:!0},4050:{id:4050,name:"skStr%",display:n,dps:!0},4051:{id:4051,name:"skAgi%",display:n,dps:!0},4052:{id:4052,name:"skInt%",display:n,dps:!0},4053:{id:4053,name:"skVit%",display:n,def:!0},4075:{id:4075,name:"skHp%",display:n,def:!0},4076:{id:4076,name:"skMp%",display:n,def:!0},10164:{id:10164,name:"intToPdmg",display:n,noCustom:!0},10165:{id:10165,name:"strToMdmg",display:n,noCustom:!0}},rankNames:{0:{id:0,name:"normal"},1:{id:1,name:"magic"},2:{id:2,name:"rare"},3:{id:3,name:"epic"},4:{id:4,name:"unique"},5:{id:5,name:"legendary"}},shopNames:{28001:"lament",28002:"lament",
28003:"lament",28004:"lament",28005:"lament",28006:"lament",28007:"lament",28008:"lament",28009:"lament",29001:"aura",29002:"aura",29003:"aura",29004:"aura",29005:"aura",29006:"aura",29007:"aura",29008:"aura",29009:"aura",5001:"medal",5002:"medal",5003:"medal",5004:"medal",5005:"medal",5006:"medal",5007:"medal",5008:"medal",5009:"medal",5101:"ladder",5102:"ladder",5103:"ladder",5104:"ladder",5105:"ladder",5106:"ladder",5107:"ladder",5108:"ladder",5109:"ladder",59001:"garden bunny",52001:"nightmare",52002:"nightmare",52003:"nightmare",52004:"nightmare",52005:"nightmare",52006:"nightmare",52007:"nightmare",52008:"nightmare",52009:"nightmare",21:"blacksmith",22:"blacksmith",23:"blacksmith",24:"blacksmith",25:"blacksmith",26:"blacksmith",27:"blacksmith",28:"blacksmith",29:"blacksmith",89001:"guild master",88001:"battlefield",88002:"battlefield",88003:"battlefield",88004:"battlefield",88005:"battlefield",88006:"battlefield",88007:"battlefield",88008:"battlefield",88009:"battlefield",66001:"erosion",35006:"plate",14051:"abyss",14052:"abyss",14053:"abyss",14054:"abyss",14055:"abyss",14056:"abyss",14057:"abyss",14058:"abyss",14059:"abyss",40011:"daredevil faire",40012:"daredevil faire",40013:"daredevil faire",40014:"daredevil faire",40015:"daredevil faire",40016:"daredevil faire",40017:"daredevil faire",40018:"daredevil faire",40001:"daredevil faire",40002:"daredevil faire",91001:"wrath",45001:"farm"},checkedRank:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},typeNames:{0:"weapons",1:"equipment",5:"plates",8:"pouch",38:"plates",90:"welspring",132:"talisman",139:"gems"},elements:{0:{id:0,name:"non-ele"},1:{id:1,name:"fire",dmgStat:16},2:{id:2,name:"ice",dmgStat:17},3:{id:3,name:"light",dmgStat:18},4:{id:4,name:"dark",dmgStat:19}},damageTypes:{0:{id:0,name:"both separate"},1:{id:1,name:"physical"},2:{id:2,name:"magical"},3:{id:3,name:"both combined"}},skillEffectMapping:{2:{id:2,name:"phyisical attack power",mapTo:3001},13:{id:13,name:"mp",mapTo:26},25:{id:25,name:"action speed"},29:{id:29,name:"magic attack power",mapTo:3002},32:{id:32,name:"fire %",mapTo:16},33:{id:33,name:"ice %",mapTo:17},34:{id:34,name:"light %",mapTo:18},35:{id:35,name:"dark %",mapTo:19},36:{id:36,name:"fire def",mapTo:20},37:{id:37,name:"ice def",mapTo:21},38:{id:38,name:"light def",mapTo:22},39:{id:39,name:"dark def",mapTo:23},58:{id:58,name:"hp%",mapTo:4075},59:{id:59,name:"mp%",mapTo:4076},65:{id:65,name:"range"},76:{id:76,name:"movement speed",mapTo:74},87:{id:87,name:"str%",mapTo:4050},88:{id:88,name:"agi%",mapTo:4051},89:{id:89,name:"int%",mapTo:4052},90:{id:90,name:"vit%",mapTo:4053},185:{id:185,name:"wots attack power",mapTo:3e3},251:{id:251,name:"critical chance%",mapTo:1012},164:{id:164,name:"intToPdmg",mapTo:10164},165:{id:165,name:"strToMdmg",mapTo:10165},222:{id:222,name:"hellfire",getVals:function(e){if(e.indexOf(";")>0){var t=e.split(";");return[{id:62,effect:222,max:Number(t[0])/100},{id:4012,effect:222,max:Number(t[1])}]}return[{id:62,effect:222,max:Number(e)/100}]}}},customItems:[{id:0,typeName:"custom",name:"wise plate fix",stats:[{id:52,max:-.001}]},{id:0,typeName:"custom",name:"hp unified",stats:[{id:4075,max:.05}]}],getStats:function(e){var t=!1,n=!1,a=!0,i="State1_Max";i in e?t=!0:(i="State1Value",i in e&&(n=!0));for(var s=0,o=[];;){s++;var r="State"+s;if(!(r in e))break;var l=e[r];if(l==-1)break;if(107==l);else{var i,m={id:l};if(t?(i="State"+s+"_Max",m.max=e[i]):n?(i="State"+s+"Value",m.max=e[i]):(i="StateValue"+s,m.max=Number(e[i])),m.max>0||m.max<0){if(a)if(i="NeedSetNum"+s,i in e){if(0==e[i])break;m.needSetNum=e[i]}else a=!1;o.push(m)}}}return o},setupStat:function(e,t){e.id=Number(t)},mergeStats:function(e,t){function n(e){var t=Number(e.max);i.stats[e.id]&&"pc"in i.stats[e.id]&&(t=Math.floor(t)),e.id in a?a[e.id]+=t:a[e.id]=t}var a={},i=this;angular.forEach(e,function(e,t){e&&n(e)}),t&&angular.forEach(t,function(e,t){e&&n(e)});var s=[];for(var o in a){var r={max:a[o],id:Number(o)};s.push(r)}return s}}}angular.module("dnsim").factory("hCodeValues",[e])}();
//# sourceMappingURL=app.min.js.map
