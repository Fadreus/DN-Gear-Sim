function SimplerReader(t,i,s){"use strict";this.pos=i,this.file=new DataView(t),this.littleEndian=s,this.readUint16=function(){return this.pos+=2,this.file.getUint16(this.pos-2,this.littleEndian)},this.readUint32=function(){return this.pos+=4,this.file.getUint32(this.pos-4,this.littleEndian)},this.readInt32=function(){return this.pos+=4,this.file.getInt32(this.pos-4,this.littleEndian)},this.readFloat32=function(){this.pos+=4;var t=this.file.getFloat32(this.pos-4,this.littleEndian);return Math.round(1e5*t)/1e5},this.readByte=function(){return this.pos+=1,this.file.getUint8(this.pos-1,this.littleEndian)},this.readString=function(){var t=this.readUint16();if(0===t)return"";if(1===t)return String.fromCharCode(this.readByte());for(var i=new Array(t),s=0;s<t;++s)i[s]=String.fromCharCode(this.readByte());var n=i.join("");return n&&n.length>6&&n.indexOf(".")>0&&!isNaN(n)?Math.round(1e5*Number(n))/1e5:n},this.skipUint16=function(){this.pos+=2},this.skipUint32=function(){this.pos+=4},this.skipInt32=function(){this.pos+=4},this.skipFloat32=function(){this.pos+=4},this.skipByte=function(){this.pos+=1},this.skipString=function(){var t=this.readUint16();this.pos+=t}}
function DntReader(){"use strict";function e(e,n){zip.createReader(new zip.BlobReader(e),function(e){e.getEntries(function(t){t[0].getData(new zip.BlobWriter,function(t){e.close(),n(t)})})},t)}function t(e){console.error(e)}this.data=[],this.columnNames=[],this.columnTypes=[],this.columnIndexes=[],this.numRows=0,this.numColumns=0,this.fileName="",this.colsToLoad=null,this.processFile=function(e,t){var n=(new Date).getTime();this.fileName=t;var s=new SimplerReader(e,4,!0),o=[];o[1]=function(e){return e.readString()},o[2]=function(e){return e.readInt32()},o[3]=function(e){return e.readInt32()},o[4]=function(e){return e.readFloat32()},o[5]=function(e){return e.readFloat32()};var i=[];i[1]=function(e){e.skipString()},i[2]=function(e){e.skipInt32()},i[3]=function(e){e.skipInt32()},i[4]=function(e){e.skipFloat32()},i[5]=function(e){e.skipFloat32()},this.numColumns=s.readUint16()+1,this.numRows=s.readUint32(),this.data=new Array(this.numRows),this.columnNames=new Array(this.numColumns),this.columnTypes=new Array(this.numColumns),this.columnNames[0]="id",this.columnTypes[0]=3;for(var r=[],l=[],a=1,u=0,m=1;m<this.numColumns;++m){var c=s.readString().substr(1),h=s.readByte();null===this.colsToLoad||this.colsToLoad[c]?(l[m]=!0,r[m]=o[h],this.columnNames[a]=c,this.columnTypes[a]=h,a++):(l[m]=!1,r[m]=i[h])}u=a;for(var d=0;d<this.numRows;++d){this.data[d]=new Array(u),this.data[d][0]=s.readUint32(),a=1;for(var m=1;m<this.numColumns;++m)l[m]?(this.data[d][a]=r[m](s),a++):r[m](s)}this.numColumns=u,this.columnIndexes={id:0};for(var m=1;m<this.numColumns;++m)this.columnIndexes[this.columnNames[m]]=m;var f=(new Date).getTime(),p=f-n;console.log("dnt process time: "+p/1e3+"s for "+t)},this.getRow=function(e){return this.convertData(this.data[e])},this.convertData=function(e){for(var t={id:e[0]},n=1;n<this.numColumns;++n)null!=e[n]&&(t[this.columnNames[n]]=e[n]);return t},this.getValue=function(e,t){return t in this.columnIndexes?this.data[e][this.columnIndexes[t]]:null},this.loadDntFromServerFile=function(e,t,n,s){var o=e;null===this.colsToLoad&&e.toUpperCase().lastIndexOf(".LZJSON")!=e.length-7&&e.toUpperCase().lastIndexOf(".JSON")!=e.length-5&&(o=e.substr(0,e.length-4)+".lzjson"),this.loadDntFromServerFileImpl(o,t,n,s)},this.loadDntFromServerFileImpl=function(t,n,s,o){var i=t.toUpperCase().lastIndexOf(".LZJSON")==t.length-7,r=t.toUpperCase().lastIndexOf(".JSON")==t.length-5,l=new XMLHttpRequest;l.open("GET",t,!0),l.responseType=i||r?"text":"blob",n("downloading dnt file "+t);var a=(new Date).getTime(),u=this;l.onerror=function(e){console.log("what! error ",e),o&&o("Cannot load file"+e)},l.ontimeout=function(e){console.log("what! timeout ",e),o&&o("Timeout loading file"+e)},l.onload=function(l){if(200===this.status){var m=this.response;if(t.toUpperCase().lastIndexOf(".DNT")===t.length-4){var c=new FileReader;c.onload=function(e){u.processFile(e.target.result,t);var n=(new Date).getTime(),o=n-a;console.log("dnt time: "+o/1e3+"s for "+t),s()},c.readAsArrayBuffer(m)}else if(r){u.processJsonFile(m,t);var h=(new Date).getTime(),d=h-a;console.log("json time: "+d/1e3+"s for "+t),s()}else if(i){u.processLzFile(m,t);var h=(new Date).getTime(),d=h-a;console.log("lzjson time: "+d/1e3+"s for "+t),s()}else n("unziping compressed dnt file"),e(m,function(e){var n=new FileReader;n.onload=function(e){u.processFile(e.target.result,t);var n=(new Date).getTime(),o=n-a;console.log("zip time: "+o/1e3+"s for "+t),s()},n.readAsArrayBuffer(e)})}else if(t.toUpperCase().lastIndexOf(".LZJSON")===t.length-7){console.log("trying dnt");var f=t.substr(0,t.length-7)+".dnt";u.loadDntFromServerFileImpl(f,n,s,o)}else if(t.toUpperCase().lastIndexOf(".DNT")===t.length-4){console.log("trying json");var p=t.substr(0,t.length-4)+".json";u.loadDntFromServerFileImpl(p,n,s,o)}else console.log("what! status "+this.status+"??"),o&&o(this.status+": Cannot load file, couldnt load zip either: "+t)},l.send()},this.processJsonFile=function(e,t){var n=JSON.parse(e);this.data=n.data,this.fileName=t,this.columnNames=n.columnNames,this.columnTypes=n.columnTypes,this.numRows=this.data.length,this.numColumns=n.columnNames.length,this.columnIndexes={id:0};for(var s=1;s<this.numColumns;++s)this.columnIndexes[this.columnNames[s]]=s},this.processLzFile=function(e,t){var n=(new Date).getTime(),s=LZString.decompressFromUTF16(e),o=(new Date).getTime(),i=o-n;console.log("decompress time: "+i/1e3+"s for "+t),this.processJsonFile(s,t)}}
function DnTranslations(){function e(e,s){zip.createReader(new zip.BlobReader(e),function(e){e.getEntries(function(t){t[0].getData(new zip.TextWriter("text/plain"),function(t){e.close(),s(t)})})},t)}function t(e){console.error(e)}this.data=null,this.sizeLimit=null,this.translate=function(e){if(null===this.data)return e;var t="";if(0===e||""===e||null===e)t=e;else if(e.toString().indexOf(",")>-1){for(var s=e.toString().split(","),n=[],o=0;o<s.length;++o){var i=s[o].replace("{","").replace("}","");n.push(s[o].replace(i,this.translate(i)))}t=n.join(",")}else if(void 0===(t=this.data[e]))if("string"==typeof e)if(0==e.indexOf("{")){var i=e.replace("{","").replace("}","");t=e.replace(i,this.translate(i))}else t=e.toString();else t=e;else"string"==typeof e&&0==t.indexOf("#N/A")&&(t="");return t},this.process=function(e,t,s){this.data={};for(var n=0,o=new DOMParser,i=o.parseFromString(e,"text/xml"),l=i.getElementsByTagName("message"),a=0;a<l.length;++a){var r=l[a].textContent;if(null===this.sizeLimit||r.length<this.sizeLimit){var g=l[a].getAttribute("mid");this.data[g]=r,n++}}try{var c=JSON.stringify(this.data);sessionStorage.setItem("UIStrings",LZString.compressToUTF16(c)),t("stored ui strings for later")}catch(e){console.log("error setting strings "+e),console.log(e.stack)}t("loaded "+n+" translations"),s()},this.loadFromSession=function(){try{this.data=null;var e=sessionStorage.getItem("UIStrings");if(null===e)return!1;var t=LZString.decompressFromUTF16(e);return this.data=JSON.parse(t),console.log("got ui strings from local storage"),!0}catch(e){return console.log("couldnt get ui strings "+e),!1}},this.loadDefaultFile=function(t,s,n,o){if(this.loadFromSession(),null!=this.data&&"object"==typeof this.data)s("using uistrings stored in local storage"),n();else if(null===t)s("Translation location required");else{console.log("data still not set"),localStorage.setItem("UIStrings_file",t);var i=new XMLHttpRequest;i.open("GET",t,!0),t.toUpperCase().lastIndexOf(".ZIP")===t.length-4?i.responseType="blob":t.toUpperCase().lastIndexOf(".XML")===t.length-4?i.responseType="document":i.responseType="text",s("downloading translation file "+t);var l=this;i.onerror=function(e){console.log("what! error ",e),o("Cannot load file"+e)},i.ontimeout=function(e){console.log("what! timeout ",e),o("Timeout loading file"+e)},i.onload=function(i){if(200===this.status){s("loading translations from "+t);var a=(new Date).getTime(),r=this.response;if(console.log("reading zip"),t.toUpperCase().lastIndexOf(".LZJSON")===t.length-7){sessionStorage.setItem("UIStrings",r),l.loadFromSession(),s("using lzjson translations"),n();var g=(new Date).getTime(),c=g-a;console.log("translations process time: "+c/1e3+"s")}else if(t.toUpperCase().lastIndexOf(".ZIP")===t.length-4)e(r,function(e){console.log("got entry data"),s("loading xml"),console.log("unzipped: "+e.length.toLocaleString()+" bytes"),l.process(e,s,n);var t=(new Date).getTime(),o=t-a;console.log("translations process time: "+o/1e3+"s")});else if(t.toUpperCase().lastIndexOf(".XML")===t.length-4){s("using xml translations"),l.process(r,s,n);var g=(new Date).getTime(),c=g-a;console.log("translations process time: "+c/1e3+"s")}}else if(t.toUpperCase().lastIndexOf(".LZJSON")===t.length-7){var f=t.substr(0,t.length-7);l.loadDefaultFile(f+".zip",s,n,o)}else if(t.toUpperCase().lastIndexOf(".ZIP")===t.length-4){var f=t.substr(0,t.length-4);l.loadDefaultFile(f+".xml",s,n,o)}else console.log("what status"+this.status+" "+t),o(this.status+": Cannot load file, couldnt load zip either: "+t)},i.send()}}}
//# sourceMappingURL=dntviewer.min.js.map
