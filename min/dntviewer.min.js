"use strict";function SimplerReader(t,i,s){this.pos=i,this.file=new DataView(t),this.littleEndian=s,this.readUint16=function(){return this.pos+=2,this.file.getUint16(this.pos-2,this.littleEndian)},this.readUint32=function(){return this.pos+=4,this.file.getUint32(this.pos-4,this.littleEndian)},this.readInt32=function(){return this.pos+=4,this.file.getInt32(this.pos-4,this.littleEndian)},this.readFloat32=function(){this.pos+=4;var t=this.file.getFloat32(this.pos-4,this.littleEndian);return Math.round(1e5*t)/1e5},this.readByte=function(){return this.pos+=1,this.file.getUint8(this.pos-1,this.littleEndian)},this.readString=function(){var t=this.readUint16();if(0===t)return"";if(1===t)return String.fromCharCode(this.readByte());for(var i=new Array(t),s=0;s<t;++s)i[s]=String.fromCharCode(this.readByte());var n=i.join("");return n&&n.length>6&&n.indexOf(".")>0&&!isNaN(n)?Math.round(1e5*Number(n))/1e5:n},this.skipUint16=function(){this.pos+=2},this.skipUint32=function(){this.pos+=4},this.skipInt32=function(){this.pos+=4},this.skipFloat32=function(){this.pos+=4},this.skipByte=function(){this.pos+=1},this.skipString=function(){var t=this.readUint16();this.pos+=t}}
"use strict";function DntReader(){function e(e,n){zip.createReader(new zip.BlobReader(e),function(e){e.getEntries(function(t){t[0].getData(new zip.BlobWriter,function(t){e.close(),n(t)})})},t)}function t(e){console.error(e)}this.data=[],this.columnNames=[],this.columnTypes=[],this.columnIndexes=[],this.numRows=0,this.numColumns=0,this.fileName="",this.colsToLoad=null,this.processFile=function(e,t){var n=(new Date).getTime();this.fileName=t;var s=new SimplerReader(e,4,!0),o=[];o[1]=function(e){return e.readString()},o[2]=function(e){return e.readInt32()},o[3]=function(e){return e.readInt32()},o[4]=function(e){return e.readFloat32()},o[5]=function(e){return e.readFloat32()};var i=[];i[1]=function(e){e.skipString()},i[2]=function(e){e.skipInt32()},i[3]=function(e){e.skipInt32()},i[4]=function(e){e.skipFloat32()},i[5]=function(e){e.skipFloat32()},this.numColumns=s.readUint16()+1,this.numRows=s.readUint32(),this.data=new Array(this.numRows),this.columnNames=new Array(this.numColumns),this.columnTypes=new Array(this.numColumns),this.columnNames[0]="id",this.columnTypes[0]=3;for(var r=[],l=[],a=1,u=0,m=1;m<this.numColumns;++m){var c=s.readString().substr(1),h=s.readByte();null===this.colsToLoad||this.colsToLoad[c]?(l[m]=!0,r[m]=o[h],this.columnNames[a]=c,this.columnTypes[a]=h,a++):(l[m]=!1,r[m]=i[h])}u=a;for(var d=0;d<this.numRows;++d){this.data[d]=new Array(u),this.data[d][0]=s.readUint32(),a=1;for(var m=1;m<this.numColumns;++m)l[m]?(this.data[d][a]=r[m](s),a++):r[m](s)}this.numColumns=u,this.columnIndexes={id:0};for(var m=1;m<this.numColumns;++m)this.columnIndexes[this.columnNames[m]]=m;var f=(new Date).getTime(),p=f-n;console.log("dnt process time: "+p/1e3+"s for "+t)},this.getRow=function(e){return this.convertData(this.data[e])},this.convertData=function(e){for(var t={id:e[0]},n=1;n<this.numColumns;++n)null!=e[n]&&(t[this.columnNames[n]]=e[n]);return t},this.getValue=function(e,t){return t in this.columnIndexes?this.data[e][this.columnIndexes[t]]:null},this.loadDntFromServerFile=function(e,t,n,s){var o=e;null===this.colsToLoad&&e.toUpperCase().lastIndexOf(".LZJSON")!=e.length-7&&(o=e.substr(0,e.length-4)+".lzjson"),this.loadDntFromServerFileImpl(o,t,n,s)},this.loadDntFromServerFileImpl=function(t,n,s,o){var i=t.toUpperCase().lastIndexOf(".LZJSON")==t.length-7,r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType=i?"text":"blob",n("downloading dnt file "+t);var l=(new Date).getTime(),a=this;r.onerror=function(e){console.log("what! error ",e),o("Cannot load file"+e)},r.ontimeout=function(e){console.log("what! timeout ",e),o("Timeout loading file"+e)},r.onload=function(r){if(200===this.status){var u=this.response;if(t.toUpperCase().lastIndexOf(".DNT")===t.length-4){var m=new FileReader;m.onload=function(e){a.processFile(e.target.result,t);var n=(new Date).getTime(),o=n-l;console.log("dnt time: "+o/1e3+"s for "+t),s()},m.readAsArrayBuffer(u)}else if(i){a.processLzFile(u,t);var c=(new Date).getTime(),h=c-l;console.log("lzjson time: "+h/1e3+"s for "+t),s()}else n("unziping compressed dnt file"),e(u,function(e){var n=new FileReader;n.onload=function(e){a.processFile(e.target.result,t);var n=(new Date).getTime(),o=n-l;console.log("zip time: "+o/1e3+"s for "+t),s()},n.readAsArrayBuffer(e)})}else if(t.toUpperCase().lastIndexOf(".LZJSON")===t.length-7){console.log("trying dnt");var d=t.substr(0,t.length-7)+".dnt";a.loadDntFromServerFileImpl(d,n,s,o)}else if(t.toUpperCase().lastIndexOf(".DNT")===t.length-4){console.log("trying zip");var f=t.substr(0,t.length-4)+".zip";a.loadDntFromServerFileImpl(f,n,s,o)}else console.log("what! status "+this.status+"??"),o(this.status+": Cannot load file, couldnt load zip either: "+t)},r.send()},this.processLzFile=function(e,t){var n=LZString.decompressFromUTF16(e),s=JSON.parse(n);this.data=s.data,this.fileName=t,this.columnNames=s.columnNames,this.columnTypes=s.columnTypes,this.numRows=this.data.length,this.numColumns=s.columnNames.length,this.columnIndexes={id:0};for(var o=1;o<this.numColumns;++o)this.columnIndexes[this.columnNames[o]]=o}}
"use strict";function DnTranslations(){function t(t,s){zip.createReader(new zip.BlobReader(t),function(t){t.getEntries(function(e){e[0].getData(new zip.TextWriter("text/plain"),function(e){t.close(),s(e)})})},e)}function e(t){console.error(t)}this.data=null,this.sizeLimit=null,this.translate=function(t){if(null===this.data)return t;var e="";if(0===t||""===t||null===t)e=t;else if(t.toString().indexOf(",")>-1){for(var s=t.toString().split(","),o=[],n=0;n<s.length;++n){var i=s[n].replace("{","").replace("}","");o.push(s[n].replace(i,this.translate(i)))}e=o.join(",")}else if(void 0===(e=this.data[t]))if("string"==typeof t)if(0==t.indexOf("{")){var i=t.replace("{","").replace("}","");e=t.replace(i,this.translate(i))}else e=t.toString();else e=t;else"string"==typeof t&&0==e.indexOf("#N/A")&&(e="");return e},this.process=function(t,e,s){this.data={};for(var o=0,n=new DOMParser,i=n.parseFromString(t,"text/xml"),l=i.getElementsByTagName("message"),a=0;a<l.length;++a){var r=l[a].textContent;if(null===this.sizeLimit||r.length<this.sizeLimit){var g=l[a].getAttribute("mid");this.data[g]=r,o++}}try{var f=JSON.stringify(this.data);sessionStorage.setItem("UIStrings",LZString.compressToUTF16(f)),e("stored ui strings for later")}catch(t){console.log("error setting strings "+t),console.log(t.stack)}e("loaded "+o+" translations"),s()},this.loadFromSession=function(){try{this.data=null;var t=sessionStorage.getItem("UIStrings");if(null===t)return!1;var e=LZString.decompressFromUTF16(t);return this.data=JSON.parse(e),console.log("got ui strings from local storage"),!0}catch(t){return console.log("couldnt get ui strings "+t),!1}},this.loadDefaultFile=function(e,s,o,n){if(this.loadFromSession(),null!=this.data&&"object"===_typeof(this.data))s("using uistrings stored in local storage"),o();else if(null===e)s("Translation location required");else{console.log("data still not set"),localStorage.setItem("UIStrings_file",e);var i=new XMLHttpRequest;i.open("GET",e,!0),e.toUpperCase().lastIndexOf(".ZIP")===e.length-4?i.responseType="blob":e.toUpperCase().lastIndexOf(".XML")===e.length-4?i.responseType="document":i.responseType="text",s("downloading translation file "+e);var l=this;i.onerror=function(t){console.log("what! error ",t),failFunc("Cannot load file"+t)},i.ontimeout=function(t){console.log("what! timeout ",t),failFunc("Timeout loading file"+t)},i.onload=function(i){if(200===this.status){s("loading translations from "+e);var a=(new Date).getTime(),r=this.response;if(console.log("reading zip"),e.toUpperCase().lastIndexOf(".LZJSON")===e.length-7){sessionStorage.setItem("UIStrings",r),l.loadFromSession(),s("using lzjson translations"),o();var g=(new Date).getTime(),f=g-a;console.log("translations process time: "+f/1e3+"s")}else if(e.toUpperCase().lastIndexOf(".ZIP")===e.length-4)t(r,function(t){console.log("got entry data"),s("loading xml"),console.log("unzipped: "+t.length.toLocaleString()+" bytes"),l.process(t,s,o);var e=(new Date).getTime(),n=e-a;console.log("translations process time: "+n/1e3+"s")});else if(e.toUpperCase().lastIndexOf(".XML")===e.length-4){s("using xml translations"),l.process(r,s,o);var g=(new Date).getTime(),f=g-a;console.log("translations process time: "+f/1e3+"s")}}else if(e.toUpperCase().lastIndexOf(".LZJSON")===e.length-7){var c=e.substr(0,e.length-7);l.loadDefaultFile(c+".zip",s,o,n)}else if(e.toUpperCase().lastIndexOf(".ZIP")===e.length-4){var c=e.substr(0,e.length-4);l.loadDefaultFile(c+".xml",s,o,n)}else console.log("what status"+this.status+" "+e),n(this.status+": Cannot load file, couldnt load zip either: "+e)},i.send()}}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};
//# sourceMappingURL=dntviewer.min.js.map
