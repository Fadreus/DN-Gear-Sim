function SimplerReader(t,e,s){"use strict";this.pos=e,this.file=new DataView(t),this.littleEndian=s,this.readUint16=function(){return this.pos+=2,this.file.getUint16(this.pos-2,this.littleEndian)},this.readUint32=function(){return this.pos+=4,this.file.getUint32(this.pos-4,this.littleEndian)},this.readInt32=function(){return this.pos+=4,this.file.getInt32(this.pos-4,this.littleEndian)},this.readFloat32=function(){this.pos+=4;var t=this.file.getFloat32(this.pos-4,this.littleEndian);return Math.round(1e5*t)/1e5},this.readByte=function(){return this.pos+=1,this.file.getUint8(this.pos-1,this.littleEndian)},this.readString=function(){var t=this.readUint16();if(0===t)return"";if(1===t)return String.fromCharCode(this.readByte());for(var e=new Array(t),s=0;s<t;++s)e[s]=String.fromCharCode(this.readByte());var n=e.join("");return n&&n.length>6&&n.indexOf(".")>0&&!isNaN(n)?Math.round(1e5*Number(n))/1e5:n},this.skipUint16=function(){this.pos+=2},this.skipUint32=function(){this.pos+=4},this.skipInt32=function(){this.pos+=4},this.skipFloat32=function(){this.pos+=4},this.skipByte=function(){this.pos+=1},this.skipString=function(){var t=this.readUint16();this.pos+=t}}function DntReader(){"use strict";function t(t,s){zip.createReader(new zip.BlobReader(t),function(t){t.getEntries(function(e){e[0].getData(new zip.BlobWriter,function(e){t.close(),s(e)})})},e)}function e(t){console.error(t)}this.data=[],this.columnNames=[],this.columnTypes=[],this.columnIndexes=[],this.numRows=0,this.numColumns=0,this.fileName="",this.colsToLoad=null,this.processFile=function(t,e){var s=(new Date).getTime();this.fileName=e;var n=new SimplerReader(t,4,(!0)),i=[];i[1]=function(t){return t.readString()},i[2]=function(t){return t.readInt32()},i[3]=function(t){return t.readInt32()},i[4]=function(t){return t.readFloat32()},i[5]=function(t){return t.readFloat32()};var o=[];o[1]=function(t){t.skipString()},o[2]=function(t){t.skipInt32()},o[3]=function(t){t.skipInt32()},o[4]=function(t){t.skipFloat32()},o[5]=function(t){t.skipFloat32()},this.numColumns=n.readUint16()+1,this.numRows=n.readUint32(),this.data=new Array(this.numRows),this.columnNames=new Array(this.numColumns),this.columnTypes=new Array(this.numColumns),this.columnNames[0]="id",this.columnTypes[0]=3;for(var r=[],a=[],l=1,u=0,h=1;h<this.numColumns;++h){var c=n.readString().substr(1),d=n.readByte();null===this.colsToLoad||this.colsToLoad[c]?(a[h]=!0,r[h]=i[d],this.columnNames[l]=c,this.columnTypes[l]=d,l++):(a[h]=!1,r[h]=o[d])}u=l;for(var f=0;f<this.numRows;++f){this.data[f]=new Array(u),this.data[f][0]=n.readUint32(),l=1;for(var h=1;h<this.numColumns;++h)a[h]?(this.data[f][l]=r[h](n),l++):r[h](n)}this.numColumns=u,this.columnIndexes={id:0};for(var h=1;h<this.numColumns;++h)this.columnIndexes[this.columnNames[h]]=h;var p=(new Date).getTime(),m=p-s;console.log("dnt process time: "+m/1e3+"s for "+e)},this.getRow=function(t){return this.convertData(this.data[t])},this.convertData=function(t){for(var e={id:t[0]},s=1;s<this.numColumns;++s)null!=t[s]&&(e[this.columnNames[s]]=t[s]);return e},this.getValue=function(t,e){return e in this.columnIndexes?this.data[t][this.columnIndexes[e]]:null},this.loadDntFromServerFile=function(t,e,s,n){var i=t;null===this.colsToLoad&&t.toUpperCase().lastIndexOf(".LZJSON")!=t.length-7&&(i=t.substr(0,t.length-4)+".lzjson"),this.loadDntFromServerFileImpl(i,e,s,n)},this.loadDntFromServerFileImpl=function(e,s,n,i){var o=e.toUpperCase().lastIndexOf(".LZJSON")==e.length-7,r=new XMLHttpRequest;r.open("GET",e,!0),o?r.responseType="text":r.responseType="blob",s("downloading dnt file "+e);var a=(new Date).getTime(),l=this;r.onload=function(r){if(200===this.status){var u=this.response;if(e.toUpperCase().lastIndexOf(".DNT")===e.length-4){var h=new FileReader;h.onload=function(t){l.processFile(t.target.result,e);var s=(new Date).getTime(),i=s-a;console.log("dnt time: "+i/1e3+"s for "+e),n()},h.readAsArrayBuffer(u)}else if(o){l.processLzFile(u,e);var c=(new Date).getTime(),d=c-a;console.log("lzjson time: "+d/1e3+"s for "+e),n()}else s("unziping compressed dnt file"),t(u,function(t){var s=new FileReader;s.onload=function(t){l.processFile(t.target.result,e);var s=(new Date).getTime(),i=s-a;console.log("zip time: "+i/1e3+"s for "+e),n()},s.readAsArrayBuffer(t)})}else if(e.toUpperCase().lastIndexOf(".LZJSON")===e.length-7){console.log("trying dnt");var f=e.substr(0,e.length-7)+".dnt";l.loadDntFromServerFileImpl(f,s,n,i)}else if(e.toUpperCase().lastIndexOf(".DNT")===e.length-4){console.log("trying zip");var p=e.substr(0,e.length-4)+".zip";l.loadDntFromServerFileImpl(p,s,n,i)}else console.log("what! status "+this.status+"??"),i(this.status+": Cannot load file, couldnt load zip either: "+e)},r.send()},this.processLzFile=function(t,e){var s=LZString.decompressFromUTF16(t),n=JSON.parse(s);this.data=n.data,this.fileName=e,this.columnNames=n.columnNames,this.columnTypes=n.columnTypes,this.numRows=this.data.length,this.numColumns=n.columnNames.length,this.columnIndexes={id:0};for(var i=1;i<this.numColumns;++i)this.columnIndexes[this.columnNames[i]]=i}}function DnTranslations(){function t(t,s){zip.createReader(new zip.BlobReader(t),function(t){t.getEntries(function(e){e[0].getData(new zip.TextWriter("text/plain"),function(e){t.close(),s(e)})})},e)}function e(t){console.error(t)}this.data=null,this.sizeLimit=null,this.translate=function(t){if(null===this.data)return t;var e="";if(0===t||""===t||null===t)e=t;else if(t.toString().indexOf(",")>-1){for(var s=t.toString().split(","),n=[],i=0;i<s.length;++i){var o=s[i].replace("{","").replace("}","");n.push(s[i].replace(o,this.translate(o)))}e=n.join(",")}else if(e=this.data[t],"undefined"==typeof e)if("string"==typeof t)if(0==t.indexOf("{")){var o=t.replace("{","").replace("}","");e=t.replace(o,this.translate(o))}else e=t.toString();else e=t;else"string"==typeof t&&0==e.indexOf("#N/A")&&(e="");return e},this.process=function(t,e,s){this.data={};for(var n=0,i=new DOMParser,o=i.parseFromString(t,"text/xml"),r=o.getElementsByTagName("message"),a=0;a<r.length;++a){var l=r[a].textContent;if(null===this.sizeLimit||l.length<this.sizeLimit){var u=r[a].getAttribute("mid");this.data[u]=l,n++}}try{var h=JSON.stringify(this.data);sessionStorage.setItem("UIStrings",LZString.compressToUTF16(h)),e("stored ui strings for later")}catch(t){console.log("error setting strings "+t),console.log(t.stack)}e("loaded "+n+" translations"),s()},this.loadFromSession=function(){try{this.data=null;var t=sessionStorage.getItem("UIStrings");if(null===t)return!1;var e=LZString.decompressFromUTF16(t);return this.data=JSON.parse(e),console.log("got ui strings from local storage"),!0}catch(t){return console.log("couldnt get ui strings "+t),!1}},this.loadDefaultFile=function(e,s,n,i){if(this.loadFromSession(),null!=this.data&&"object"==typeof this.data)s("using uistrings stored in local storage"),n();else if(null===e)s("Translation location required");else{console.log("data still not set"),localStorage.setItem("UIStrings_file",e);var o=new XMLHttpRequest;o.open("GET",e,!0),e.toUpperCase().lastIndexOf(".ZIP")===e.length-4?o.responseType="blob":e.toUpperCase().lastIndexOf(".XML")===e.length-4?o.responseType="document":o.responseType="text",s("downloading translation file "+e);var r=this;o.onload=function(o){if(200===this.status){s("loading translations from "+e);var a=(new Date).getTime(),l=this.response;if(console.log("reading zip"),e.toUpperCase().lastIndexOf(".LZJSON")===e.length-7){sessionStorage.setItem("UIStrings",l),r.loadFromSession(),s("using lzjson translations"),n();var u=(new Date).getTime(),h=u-a;console.log("translations process time: "+h/1e3+"s")}else if(e.toUpperCase().lastIndexOf(".ZIP")===e.length-4)t(l,function(t){console.log("got entry data"),s("loading xml"),console.log("unzipped: "+t.length.toLocaleString()+" bytes"),r.process(t,s,n);var e=(new Date).getTime(),i=e-a;console.log("translations process time: "+i/1e3+"s")});else if(e.toUpperCase().lastIndexOf(".XML")===e.length-4){s("using xml translations"),r.process(l,s,n);var u=(new Date).getTime(),h=u-a;console.log("translations process time: "+h/1e3+"s")}}else if(e.toUpperCase().lastIndexOf(".LZJSON")===e.length-7){var c=e.substr(0,e.length-7);r.loadDefaultFile(c+".zip",s,n,i)}else if(e.toUpperCase().lastIndexOf(".ZIP")===e.length-4){var c=e.substr(0,e.length-4);r.loadDefaultFile(c+".xml",s,n,i)}else console.log("what status"+this.status+" "+e),i(this.status+": Cannot load file, couldnt load zip either: "+e)},o.send()}}}
//# sourceMappingURL=dntviewer.min.js.map
